---
const { course } = Astro.props;

// LOGIC DATA HARGA SUNGGUHAN (SESUAI JSON)
const price = course.price; // Harga jual
const originalPrice = course.originalPrice; // Harga coret

// Hitung % Diskon jika ada original price
let discountBadge = "";
let saveAmount = 0;
if (originalPrice && originalPrice > price) {
    saveAmount = Math.round(originalPrice - price);
    if (price === 0) {
        discountBadge = "100% OFF";
    } else {
        const percent = Math.round(((originalPrice - price) / originalPrice) * 100);
        discountBadge = `${percent}% OFF`;
    }
} else if (price === 0) {
    discountBadge = "100% OFF"; 
}

const subcategorySlug = course.subcategory ? course.subcategory.toLowerCase().replace(/\s+/g, '-') : '';
const categorySlug = course.category ? course.category.toLowerCase().replace(/\s+/g, '-') : '';
const badgeLink = course.subcategory ? `/courses/subcategory/${subcategorySlug}` : `/courses/category/${categorySlug}`;

const isTopRated = course.rating >= 4.7;
const isPopular = course.students >= 10000;
---

<div class="group relative bg-[#1c252e] border border-[#2d3748] rounded-2xl overflow-hidden hover:border-green-500 hover:shadow-2xl hover:shadow-green-500/10 hover:-translate-y-1 transition-all duration-300 h-full flex flex-col">
  <!-- Detail Link Wrapper for Image/Title -->
  <a href={`/coupon/${course.slug}`} class="absolute inset-0 z-0"></a>

  <!-- Image -->
  <div class="relative aspect-video overflow-hidden z-10 pointer-events-none">
    <img 
        src={course.image} 
        alt={course.title} 
        class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" 
        loading="lazy" 
    />
    <div class="absolute inset-0 bg-gradient-to-t from-[#1a1d29] via-transparent to-transparent opacity-60"></div>
    
    <!-- Top Left Badges (Cleaned up: only minor status if needed, but keeping it empty for now as requested) -->
    <div class="absolute top-2 left-2 flex flex-col gap-1.5 z-20">
    </div>

    <!-- Top Right Status Badges -->
    <div class="absolute top-2 right-2 flex flex-col gap-1 z-20">
        {isTopRated && (
            <span class="bg-yellow-500 text-black text-[9px] font-black px-1.5 py-0.5 rounded shadow-lg flex items-center gap-1 uppercase">
                â˜… Top Rated
            </span>
        )}
        {isPopular && (
            <span class="bg-blue-500 text-white text-[9px] font-black px-1.5 py-0.5 rounded shadow-lg flex items-center gap-1 uppercase">
                ðŸ”¥ Popular
            </span>
        )}
    </div>

    <!-- Duration Badge (Bottom Right) -->
    {course.duration && (
        <div class="absolute bottom-2 right-2 bg-black/60 backdrop-blur-md px-2 py-0.5 rounded text-[10px] text-white font-medium flex items-center gap-1 border border-white/10">
            <svg class="w-3 h-3 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            {course.duration}
        </div>
    )}
  </div>
  
  <!-- Content -->
  <div class="p-4 flex flex-col flex-grow">
      <div class="flex items-center gap-2 mb-2 text-[10px] text-gray-500 font-bold uppercase tracking-widest leading-none">
        <span>{new Date(course.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</span>
        <span class="w-1 h-1 bg-gray-600 rounded-full"></span>
        <a 
            href={badgeLink}
            class="text-[#10b981] hover:underline relative z-20"
            onclick="event.stopPropagation()"
        >
            {course.subcategory || course.category}
        </a>
      </div>
      
      <h3 class="font-bold text-white text-md mb-2 leading-tight group-hover:text-green-400 transition-colors line-clamp-2 relative z-10">
        {course.title}
      </h3>

      <div class="flex items-center gap-2 mb-3 text-[11px] text-gray-400 leading-none">
        <svg class="w-3.5 h-3.5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
        </svg>
        <span class="truncate">By {course.instructor || "Expert Instructor"}</span>
      </div>

      <p class="text-gray-400 text-xs leading-relaxed line-clamp-2 mb-4 flex-grow opacity-80">
        {course.description || course.seoDescription || "Explore this comprehensive course and master new skills with expert guidance and hands-on projects."}
      </p>
      
      <div class="mt-auto pt-3 border-t border-[#2d3748] flex flex-col gap-3">
        <div class="flex justify-between items-center">
            <!-- Rating -->
            <div class="flex items-center gap-1.5">
               <div class="flex items-center text-yellow-500 text-xs">
                  <span class="font-bold text-[14px]">â˜…</span>
                  <span class="ml-0.5 font-bold text-gray-100">{course.rating || "4.8"}</span>
               </div>
               <span class="text-gray-500 text-[10px] bg-[#1a1d29] px-1.5 py-1 rounded border border-[#2d3748] font-medium">
                {course.students?.toLocaleString() || "1.2k"}+
               </span>
            </div>
            
            <!-- Price Display -->
            <div class="flex items-center gap-2 leading-none">
               {originalPrice && originalPrice > price && (
                  <span class="text-gray-500 line-through text-[11px]">${originalPrice}</span>
               )}
               <span class={`${price === 0 ? 'text-[#10b981]' : 'text-white'} font-bold text-lg`}>
                    {price === 0 ? 'FREE' : `$${price}`}
               </span>
            </div>
        </div>

        <div class="flex items-center justify-between">
            {discountBadge ? (
                <span class="text-[10px] font-bold text-orange-400 bg-orange-400/10 px-2 py-0.5 rounded border border-orange-400/20 uppercase tracking-tight">
                    {discountBadge}
                </span>
            ) : (
                <span></span>
            )}
            <span class="text-[#10b981] text-[10px] font-bold flex items-center gap-1 uppercase tracking-wider">
                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                Verified
            </span>
        </div>
      </div>

      <!-- Get Coupon Button -->
      <div class="mt-4 relative z-20">
        <a 
          href={course.url} 
          target="_blank" 
          rel="nofollow noopener"
          class="block w-full py-2.5 bg-gradient-to-r from-[#059669] to-[#10b981] text-white text-sm font-bold rounded-xl text-center shadow-lg shadow-green-500/10 hover:shadow-green-500/20 hover:scale-[1.02] active:scale-95 transition-all flex items-center justify-center gap-2 uppercase tracking-wide group/btn"
        >
          <span>Get Coupon</span>
          <svg class="w-4 h-4 transition-transform group-hover/btn:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
          </svg>
        </a>
      </div>
  </div>
</div>

