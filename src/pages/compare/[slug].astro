---
import MainLayout from '../../layouts/MainLayout.astro';
import { getCollection } from 'astro:content';
import { formatDate } from '../../lib/posts';

export async function getStaticPaths() {
  const comparePosts = await getCollection('blog', ({ id }) => {
    return id.startsWith('compare/');
  });
  
  return comparePosts.map(post => {
    // The slug for 'compare/best-coding-platforms/index.md' might be 'compare/best-coding-platforms'
    // but the part after /compare/ is what we want for this route
    const slug = post.slug.replace('compare/', '');
    return {
      params: { slug },
      props: { post },
    };
  });
}

const { post } = Astro.props;
const { Content } = await post.render();

const site = "https://courseswyn.com";
const canonical = `${site}/compare/${post.slug.replace('compare/', '')}/`;

const structuredData = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": post.data.title,
  "description": post.data.description,
  "datePublished": post.data.pubDate.toISOString(),
  "author": {
    "@type": "Organization",
    "name": "CoursesWyn"
  }
};
---

<MainLayout 
  title={post.data.title}
  description={post.data.description}
  canonical={canonical}
  structuredData={structuredData}
>
  <article class="max-w-4xl mx-auto px-6 py-12 dot-matrix">
    <div class="mb-10 text-center">
      <div class="inline-block px-3 py-1 rounded bg-primary/10 border border-primary/20 text-primary text-xs font-mono font-bold tracking-widest mb-6">
        COMPARISON
      </div>
      <h1 class="text-4xl sm:text-5xl font-bold text-foreground leading-tight mb-6 tracking-tight">
        {post.data.title}
      </h1>
      <p class="text-xl text-muted-foreground max-w-2xl mx-auto leading-relaxed">
        {post.data.description}
      </p>
      <div class="flex items-center justify-center gap-4 mt-8 text-sm text-muted-foreground font-mono">
        <span>Updated: {formatDate(post.data.updatedAt || post.data.pubDate)}</span>
        <span>â€¢</span>
        <span>by CoursesWyn Team</span>
      </div>
    </div>

    <hr class="border-border mb-12" />

    <div class="prose prose-lg prose-invert max-w-none 
      prose-headings:text-foreground prose-headings:font-bold prose-headings:tracking-tight
      prose-p:text-muted-foreground prose-p:leading-relaxed
      prose-a:text-primary hover:prose-a:underline
      prose-strong:text-foreground
      prose-table:border prose-table:border-border
      prose-th:bg-muted/50 prose-th:text-foreground prose-th:font-mono prose-th:text-xs prose-th:uppercase prose-th:tracking-widest
      prose-td:text-sm prose-td:text-muted-foreground prose-td:border-t prose-td:border-border">
      <Content />
    </div>

    <div class="mt-20 p-8 rounded-xl border border-primary/20 bg-primary/5 text-center relative overflow-hidden">
      <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,_hsl(var(--primary)_/_0.05),_transparent)]"></div>
      <h3 class="text-2xl font-bold text-foreground relative">Found your platform?</h3>
      <p class="text-muted-foreground mt-3 mb-8 relative max-w-md mx-auto">
        Start your learning journey today with our exclusive discounts and curated course paths.
      </p>
      <div class="flex flex-wrap justify-center gap-4 relative">
        <a href="https://trk.udemy.com/c/6564357/3193860/39854" class="bg-primary text-primary-foreground px-8 py-3 rounded-md font-bold hover:bg-primary/90 transition-all shadow-lg shadow-primary/25">
          Get Udemy Coupons
        </a>
        <a href="/providers" class="bg-secondary text-foreground px-8 py-3 rounded-md font-bold hover:bg-secondary/80 transition-all border border-border">
          Compare All Providers
        </a>
      </div>
    </div>
  </article>
</MainLayout>
