---
import Layout from '../../layouts/Layout.astro';
import BlogCard from '../../components/blog/BlogCard.astro';
import { fetchPosts, formatDate, paginate, tagToLabel } from '../../lib/posts';
import Search from '../../components/Search.astro';

const posts = await fetchPosts();
const pageParam = Number(Astro.url?.searchParams.get('page') ?? '1');
const { slice, currentPage, totalPages } = paginate(posts, isNaN(pageParam) ? 1 : pageParam);

const baseUrl = '/blog/';
const pageHref = (page: number) => (page <= 1 ? baseUrl : `${baseUrl}?page=${page}`);
---

<Layout title="Course Reviews & Learning Guides - CoursesWyn" description="Expert Udemy course reviews covering AI, Python, Web Development, Data Science, Excel & more. In-depth guides with real student feedback and course comparisons.">
  <section class="mb-12 space-y-4">
    <h1 class="text-4xl font-semibold text-white">Course Reviews & Learning Guides</h1>
    <p class="text-white/70 max-w-2xl">
      In-depth, independent reviews of the best Udemy courses. Find expert recommendations for AI, Python, Web Development, Data Science, and 50+ other categories.
    </p>
  </section>

  <Search posts={posts} />

  <section class="deals-grid my-12">
    {slice.map((post) => (
      <BlogCard
        title={post.data.title}
        description={post.data.description}
        slug={post.slug}
        pubDate={post.data.pubDate}
        tags={post.data.tags}
        image={post.data.image}
      />
    ))}
  </section>

  {totalPages > 1 && (
    <nav class="mt-12 flex items-center justify-between text-sm text-white/70">
      <a
        class:list={{
          'text-white hover:text-mint-300': currentPage > 1,
          'text-white/30 pointer-events-none': currentPage === 1,
        }}
        href={pageHref(currentPage - 1)}
      >
        ← Newer posts
      </a>
      <span class="text-white/60">
        Page {currentPage} of {totalPages}
      </span>
      <a
        class:list={{
          'text-white hover:text-mint-300': currentPage < totalPages,
          'text-white/30 pointer-events-none': currentPage === totalPages,
        }}
        href={pageHref(currentPage + 1)}
      >
        Older posts →
      </a>
    </nav>
  )}
</Layout>
