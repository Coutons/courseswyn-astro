---
import Layout from "../../layouts/Layout.astro";
import BlogCard from "../../components/blog/BlogCard.astro";
import { fetchPosts, formatDate, paginate, tagToLabel } from "../../lib/posts";
import Search from "../../components/Search.astro";

const posts = await fetchPosts();
const { slice, currentPage, totalPages } = paginate(posts, 1);

const baseUrl = "/blog/";
const pageHref = (page: number) =>
  page <= 1 ? baseUrl : `${baseUrl}page/${page}/`;

const title = "Udemy Course Reviews & Learning Guides - CoursesWyn";
const description =
  "In-depth, independent reviews of the best Udemy courses. Find expert recommendations for AI, Python, Web Development, Data Science, and 50+ other categories.";
const canonical = "https://courseswyn.com/blog/";

const structuredData = {
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  name: title,
  description: description,
  url: canonical,
  mainEntity: {
    "@type": "Blog",
    headline: "Udemy Course Reviews & Learning Guides",
    description: description,
    blogPost: slice.map((post) => ({
      "@type": "BlogPosting",
      headline: post.data.title,
      description: post.data.description,
      url: `https://courseswyn.com/${post.slug}/`,
      datePublished: post.data.pubDate.toISOString(),
      author: {
        "@type": "Organization",
        name: "CoursesWyn",
      },
      image:
        post.data.image?.src || "https://courseswyn.com/images/og-default.svg",
    })),
  },
};
---

<Layout
  title={title}
  description={description}
  canonical={canonical}
  structuredData={structuredData}
>
  <!-- Breadcrumb Navigation for SEO -->
  <nav class="mb-8 text-sm" aria-label="Breadcrumb">
    <ol class="flex items-center space-x-2">
      <li>
        <a href="/" class="text-slate-300 hover:text-blue-400 transition-colors"
          >Home</a
        >
      </li>
      <li class="flex items-center">
        <svg
          class="w-4 h-4 mx-2 text-slate-600"
          fill="currentColor"
          viewBox="0 0 20 20"
        >
          <path
            fill-rule="evenodd"
            d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
            clip-rule="evenodd"></path>
        </svg>
        <span class="text-blue-300 font-semibold">Blog</span>
      </li>
    </ol>
  </nav>

  <header class="mb-10 border-b border-slate-700 pb-8">
    <h1 class="text-5xl font-bold text-slate-100 mb-4">
      Udemy Course Reviews & Learning Guides
    </h1>
    <p class="text-xl text-slate-400 leading-relaxed">
      In-depth, independent reviews of the best Udemy courses across 50+
      categories. Find expert recommendations for AI, Python, Web Development,
      Data Science, Business, Marketing, Design, and more.
    </p>
  </header>

  <Search id="blog-index" posts={posts} />

  <!-- Blog List -->
  <section class="flex flex-col gap-10 my-12 text-left">
    {
      slice.map((post) => (
        <BlogCard
          title={post.data.title}
          description={post.data.description}
          slug={post.slug}
          pubDate={post.data.pubDate}
          updatedAt={post.data.updatedAt}
          tags={post.data.tags}
          image={post.data.image}
        />
      ))
    }
  </section>

  <!-- Pagination -->
  {
    totalPages > 1 && (
      <div class="mt-12 flex justify-center items-center gap-4">
        <nav class="flex space-x-2" aria-label="Pagination">
          {currentPage > 1 && (
            <a
              href={pageHref(currentPage - 1)}
              class="px-4 py-2 border border-slate-700 rounded-lg hover:bg-slate-800 hover:border-blue-500 text-slate-300 transition-all duration-300"
            >
              Previous
            </a>
          )}

          {Array.from({ length: totalPages }, (_, i) => i + 1).map(
            (pageNum) => (
              <a
                href={pageHref(pageNum)}
                class={`px-4 py-2 border rounded-lg transition-all duration-300 ${
                  pageNum === currentPage
                    ? "bg-blue-600 text-white border-blue-600 font-semibold"
                    : "border-slate-700 hover:bg-slate-800 hover:border-slate-600 text-slate-300"
                }`}
              >
                {pageNum}
              </a>
            ),
          )}

          {currentPage < totalPages && (
            <a
              href={pageHref(currentPage + 1)}
              class="px-4 py-2 border border-slate-700 rounded-lg hover:bg-slate-800 hover:border-blue-500 text-slate-300 transition-all duration-300"
            >
              Next
            </a>
          )}
        </nav>

        <p class="text-sm text-slate-400 font-medium">
          Page {currentPage} of {totalPages}
        </p>
      </div>
    )
  }
</Layout>
