---
import MainLayout from "../../../layouts/MainLayout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths({ paginate }: { paginate: any }) {
  const posts = await getCollection('blog');
  const sortedPosts = posts.sort((a, b) => {
    const dateA = a.data.updatedAt || a.data.pubDate;
    const dateB = b.data.updatedAt || b.data.pubDate;
    return dateB.getTime() - dateA.getTime();
  });

  return paginate(sortedPosts, { pageSize: 6 });
}

const { page } = Astro.props as { page: any };
const posts: any[] = page?.data ?? [];

// Date formatting function
function formatDate(post: any) {
  const isUpdated = !!post.data.updatedAt;
  const date = post.data.updatedAt || post.data.pubDate;
  const formatted = new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
  }).format(date);
  return isUpdated ? `Updated ${formatted}` : formatted;
}

const title = `Latest Udemy Course Reviews & Learning Guides - Page ${page.currentPage} | Courses Wyn`;
const description = "Browse all Udemy Courses guides, tutorials, comparisons, and reviews. Find the best Udemy Courses for your project.";
const canonical = `https://courseswyn.com/blog/page/${page.currentPage}`;

const structuredData = {
  "@context": "https://schema.org",
  "@type": "Blog",
  headline: title,
  description: description,
  url: canonical,
  blogPost: posts.map((post: any) => ({
    "@type": "BlogPosting",
    headline: post.data.title,
    description: post.data.description,
    url: `https://courseswyn.com/blog/${post.slug}`,
    datePublished: post.data.pubDate.toISOString(),
    author: {
      "@type": "Person",
      name: "Josh Smith",
      url: "mailto:coutonscom@gmail.com",
    },
  })),
};
---

<MainLayout
  title={title}
  description={description}
  canonical={canonical}
  structuredData={structuredData}
>
  <div class="bg-[#1c252e] min-h-screen pb-20">

    <!-- Header Section -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-24 pb-16">
      <div class="text-center">
        <h1 class="text-4xl md:text-6xl font-black text-white mb-6 leading-tight">
          Udemy Course Reviews &
          <span class="text-transparent bg-clip-text bg-gradient-to-r from-[#10b981] to-[#3b82f6]">Learning Guides</span>
        </h1>
        <p class="text-xl md:text-2xl text-gray-300 font-medium mb-6">
          Page {page.currentPage} ‚Ä¢ Expert Insights, Tutorials & Reviews
        </p>
        <p class="text-gray-400 max-w-3xl mx-auto leading-relaxed mb-10 text-lg">
          Browse our comprehensive collection of Udemy course reviews, learning guides, tutorials, and expert insights.
        </p>

        <!-- Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-8 mb-12 max-w-3xl mx-auto border-t border-b border-[#2d3748] py-8">
          <div>
            <div class="text-4xl font-black text-[#10b981]">{posts.length}</div>
            <div class="text-gray-500 text-sm font-bold uppercase tracking-wider mt-1">Posts This Page</div>
          </div>
          <div>
            <div class="text-4xl font-black text-[#10b981]">{page.currentPage}</div>
            <div class="text-gray-500 text-sm font-bold uppercase tracking-wider mt-1">Current Page</div>
          </div>
          <div>
            <div class="text-4xl font-black text-[#10b981]">{page.lastPage}</div>
            <div class="text-gray-500 text-sm font-bold uppercase tracking-wider mt-1">Total Pages</div>
          </div>
          <div>
            <div class="text-4xl font-black text-[#10b981]">{page.total}</div>
            <div class="text-gray-500 text-sm font-bold uppercase tracking-wider mt-1">Total Posts</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Blog Posts Grid -->
    <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-16">
      <div class="flex items-center gap-3 mb-8">
        <span class="w-1.5 h-8 bg-[#10b981] rounded-full"></span>
        <h2 class="text-2xl font-bold text-white">Latest Articles - Page {page.currentPage}</h2>
      </div>

      {posts.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
          {posts.map((post: any) => (
            <a
              href={`/blog/${post.slug}`}
              class="group block bg-[#28323d] border border-[#2d3748] rounded-2xl overflow-hidden hover:border-[#10b981] hover:shadow-xl hover:shadow-[#10b981]/10 transition-all duration-300 hover:-translate-y-2"
            >
              <!-- Image -->
              <div class="relative aspect-[16/9] overflow-hidden">
                <img
                  src={post.data.image?.src || post.data.image || 'https://images.unsplash.com/photo-1526379095098-d400fd0bf935?w=800&h=400&fit=crop'}
                  alt={post.data.title}
                  class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                  loading="lazy"
                />
                {post.data.tags && post.data.tags[0] && (
                  <div class="absolute top-4 left-4">
                    <span class="bg-[#1c252e]/80 backdrop-blur-md text-green-400 text-[10px] font-bold px-2 py-1 rounded-md border border-green-500/30 uppercase tracking-wider">
                      {post.data.tags[0]}
                    </span>
                  </div>
                )}
              </div>

              <!-- Content -->
              <div class="p-6">
                <div class="flex flex-wrap items-center gap-2 mb-3 text-xs text-gray-400">
                  <div class="flex items-center gap-1.5 bg-[#1f2937] px-2 py-1 rounded border border-[#374151]">
                    <img src="/assets/authors/josh-smith.png" alt="Josh Smith" class="w-5 h-5 rounded-full object-cover border border-[#10b981]/30" />
                    <span class="truncate max-w-[80px] text-white font-medium">
                      Josh Smith
                    </span>
                  </div>
                  <span>‚Ä¢</span>
                  <span>{formatDate(post)}</span>
                </div>

                <h3 class="font-bold text-white text-lg mb-3 leading-tight group-hover:text-[#10b981] transition-colors line-clamp-2">
                  {post.data.title}
                </h3>

                <p class="text-gray-400 text-sm leading-relaxed line-clamp-3 mb-4">
                  {post.data.description}
                </p>

                <!-- Read More -->
                <div class="flex items-center justify-between">
                  <span class="inline-block px-4 py-2 bg-[#10b981]/10 border border-[#10b981]/30 text-[#10b981] text-xs font-bold rounded-lg group-hover:bg-[#10b981] group-hover:text-white transition-all">
                    Read Article ‚Üí
                  </span>
                </div>
              </div>
            </a>
          ))}
        </div>
      ) : (
        <div class="text-center py-16">
          <div class="text-gray-400 text-lg mb-4">No blog posts found</div>
          <a href="/blog" class="inline-block px-6 py-3 bg-[#10b981] text-white rounded-lg hover:bg-[#059669] transition-colors">
            Back to Blog
          </a>
        </div>
      )}

      <!-- Pagination -->
      <div class="flex justify-center">
        <div class="flex items-center gap-2 bg-[#28323d] p-2 rounded-xl border border-[#2d3748]">
          {page.url.prev ? (
            <a href={page.url.prev} class="px-4 h-10 flex items-center gap-2 rounded-lg text-gray-400 hover:text-white hover:bg-[#1c252e] transition-all text-sm font-bold">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
              Previous
            </a>
          ) : null}

          <span class="px-4 h-10 flex items-center rounded-lg bg-[#10b981] text-white font-bold text-sm">
            Page {page.currentPage} of {page.lastPage}
          </span>

          {page.url.next ? (
            <a href={page.url.next} class="px-4 h-10 flex items-center gap-2 rounded-lg text-gray-400 hover:text-white hover:bg-[#1c252e] transition-all text-sm font-bold">
              Next
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </a>
          ) : null}
        </div>
      </div>
    </section>

    <!-- SEO Content Section -->
    <section class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 pb-20">
      <div class="prose prose-invert prose-lg max-w-none">
        <h2 class="text-3xl font-bold text-white text-center mb-8">Expert Udemy Course Guides & Reviews</h2>

        <div class="text-gray-400 space-y-6 leading-relaxed text-base">
          <p>
            Welcome to CoursesWyn's comprehensive blog featuring expert reviews, detailed guides, and insights into the best Udemy courses. Our experienced team analyzes thousands of courses to bring you honest reviews and practical learning guides.
          </p>

          <h3 class="text-white font-bold text-xl">What You'll Find in Our Blog</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 my-8">
            <div class="bg-[#28323d] border border-[#2d3748] rounded-xl p-6">
              <h4 class="text-[#10b981] font-bold text-lg mb-3">üìã Course Reviews</h4>
              <p class="text-gray-300 text-sm">In-depth reviews of popular Udemy courses with pros, cons, and honest feedback from real students.</p>
            </div>
            <div class="bg-[#28323d] border border-[#2d3748] rounded-xl p-6">
              <h4 class="text-[#10b981] font-bold text-lg mb-3">üõ£Ô∏è Learning Paths</h4>
              <p class="text-gray-300 text-sm">Structured learning roadmaps to help you master specific skills and technologies.</p>
            </div>
            <div class="bg-[#28323d] border border-[#2d3748] rounded-xl p-6">
              <h4 class="text-[#10b981] font-bold text-lg mb-3">üí° Tutorials</h4>
              <p class="text-gray-300 text-sm">Step-by-step tutorials and guides for common development tasks and challenges.</p>
            </div>
            <div class="bg-[#28323d] border border-[#2d3748] rounded-xl p-6">
              <h4 class="text-[#10b981] font-bold text-lg mb-3">üîç Comparisons</h4>
              <p class="text-gray-300 text-sm">Detailed comparisons between similar courses to help you choose the best option.</p>
            </div>
          </div>

          <h3 class="text-white font-bold text-xl">Why Trust Our Reviews?</h3>
          <p>
            Our blog content is created by experienced developers, educators, and Udemy course experts who have personally taken and reviewed hundreds of courses. We provide honest, unbiased opinions to help you make informed learning decisions.
          </p>

          <p class="text-sm mt-8 pt-6 border-t border-[#2d3748] text-center">
            <em><strong>Disclaimer:</strong> We are not affiliated with Udemy.com. All logos and trademarks belong to their respective owners. We merely provide educational content to help students make informed decisions.</em>
          </p>
        </div>
      </div>
    </section>

  </div>
</MainLayout>
