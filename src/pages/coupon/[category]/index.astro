---
import Layout from '../../../layouts/Layout.astro';
import Breadcrumb from '../../../components/Breadcrumb.astro';
import courses from '../../../data/coupons.json';

export async function getStaticPaths() {
  const categoryMap = new Map();

  courses.forEach(course => {
    if (!categoryMap.has(course.category)) {
      categoryMap.set(course.category, {
        category: course.category,
        subCategories: new Set(),
        courses: []
      });
    }
    categoryMap.get(course.category).subCategories.add(course.subCategory);
    categoryMap.get(course.category).courses.push(course);
  });

  return Array.from(categoryMap.values()).map(({ category, subCategories, courses: categoryCourses }) => ({
    params: {
      category: category.toLowerCase().replace(/\s+/g, '-')
    },
    props: {
      category,
      subCategories: Array.from(subCategories),
      courses: categoryCourses
    }
  }));
}

const { category, subCategories, courses: categoryCourses } = Astro.props;

const title = `${category} Courses - Best Udemy Coupons 2026`;
const description = `Discover the best ${category} courses on Udemy with our verified coupons. Explore ${subCategories.length} subcategories with lifetime access and certificates. Save up to 95% on premium courses.`;
const keywords = `${category}, udemy coupons, free courses, discount codes, ${category} certification, online learning, ${subCategories.join(', ')}`;
const canonical = `https://courseswyn.com/coupon/category/${category.toLowerCase().replace(/\s+/g, '-')}`;
---

<Layout
  title={title}
  description={description}
  keywords={keywords}
  canonical={canonical}
 >

<Breadcrumb
  category={category}
  isCategoryPage={true}
/>

<div class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-900 to-slate-800">

  <!-- Header Section -->
  <div class="bg-gradient-to-r from-slate-900 to-slate-800 border-b border-slate-700 py-12 mb-8">
    <div class="max-w-6xl mx-auto px-4">
      <h1 class="text-3xl lg:text-4xl font-bold text-white mb-4">
        {category} Courses - Best Udemy Coupons 2026
      </h1>
      <p class="text-slate-300 text-lg leading-relaxed mb-6">
        Master {category} with our curated selection of premium Udemy courses.
        Get lifetime access to high-quality education with up to 95% OFF using our verified coupons.
      </p>

      <!-- Stats -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-gradient-to-r from-blue-600/20 to-blue-500/20 p-6 rounded-xl border border-blue-500/30">
          <div class="text-center">
            <div class="text-3xl font-bold text-blue-400 mb-2">{subCategories.length}</div>
            <div class="text-slate-300 font-medium">Subcategories</div>
          </div>
        </div>
        <div class="bg-gradient-to-r from-green-600/20 to-green-500/20 p-6 rounded-xl border border-green-500/30">
          <div class="text-center">
            <div class="text-3xl font-bold text-green-400 mb-2">{categoryCourses.length}</div>
            <div class="text-slate-300 font-medium">Total Courses</div>
          </div>
        </div>
        <div class="bg-gradient-to-r from-purple-600/20 to-purple-500/20 p-6 rounded-xl border border-purple-500/30">
          <div class="text-center">
            <div class="text-3xl font-bold text-purple-400 mb-2">95%</div>
            <div class="text-slate-300 font-medium">Max Discount</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Subcategories Grid -->
  <div class="max-w-7xl mx-auto px-4 pb-16">
    <div class="mb-8">
      <h2 class="text-2xl font-bold text-white mb-2">Explore {category} Subcategories</h2>
      <p class="text-slate-300">Choose from our specialized {category} courses to advance your skills</p>
    </div>

    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
      {(subCategories as string[]).map((subCat: string) => {
        const subCourses = (categoryCourses as any[]).filter((c: any) => c.subCategory === subCat);
        const avgRating = (subCourses.reduce((sum: number, c: any) => sum + parseFloat(c.rating), 0) / subCourses.length).toFixed(1);

        return (
          <div class="bg-gradient-to-br from-slate-800 to-slate-900 border border-slate-700 rounded-xl shadow-sm hover:shadow-lg hover:border-blue-500 transition-all duration-200 overflow-hidden group">
            <div class="p-6">
              <h3 class="font-bold text-white mb-3 text-lg leading-tight group-hover:text-blue-400 transition-colors">
                <a href={`/coupon/${category.toLowerCase().replace(/\s+/g, '-')}/${subCat.toLowerCase().replace(/\s+/g, '-').replace(/&/g, 'and').replace(/\//g, '-')}`}>
                  {subCat}
                </a>
              </h3>

              <div class="flex items-center justify-between mb-4">
                <div class="flex items-center">
                  <span class="text-sm font-medium text-slate-300">{subCourses.length} courses</span>
                </div>
                <div class="flex items-center">
                  <span class="text-sm font-medium text-white mr-1">{avgRating}</span>
                  <span class="text-yellow-400 text-sm">â˜…</span>
                </div>
              </div>

              <p class="text-slate-400 text-sm mb-4 line-clamp-2">
                Explore {subCourses.length} premium {subCat} courses with verified Udemy coupons.
              </p>

              <a
                href={`/coupon/${category.toLowerCase().replace(/\s+/g, '-')}/${subCat.toLowerCase().replace(/\s+/g, '-').replace(/&/g, 'and').replace(/\//g, '-')}`}
                class="block w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold py-3 px-4 rounded-lg text-center transition-all duration-200 transform hover:scale-105"
              >
                View {subCat} Courses
              </a>
            </div>
          </div>
        );
      })}
    </div>

    <!-- Featured Courses -->
    <div class="bg-gradient-to-br from-slate-800 to-slate-900 border border-slate-700 rounded-xl shadow-sm p-8">
      <h2 class="text-2xl font-bold text-white mb-6">Featured {category} Courses</h2>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {(categoryCourses as any[]).slice(0, 6).map((course: any) => (
          <div class="bg-gradient-to-br from-slate-900 to-slate-900 border border-slate-700 rounded-lg p-4 hover:shadow-md hover:border-blue-500 transition-all">
            <h4 class="font-semibold text-white mb-2 line-clamp-2">
              <a href={`/coupon/${course.slug}`} class="hover:text-blue-400">
                {course.title}
              </a>
            </h4>
            <p class="text-sm text-slate-400 mb-2">{course.subCategory}</p>
            <div class="flex items-center justify-between">
              <span class="text-lg font-bold text-cyan-400">{course.price}</span>
              <span class="text-sm text-slate-600 line-through">{course.originalPrice}</span>
            </div>
            <div class="mt-2 text-xs text-yellow-400 font-medium">{course.discount} OFF</div>
          </div>
        ))}
      </div>
    </div>
  </div>
</div>
</Layout>