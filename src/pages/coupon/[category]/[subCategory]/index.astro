---
import Layout from '../../../../layouts/Layout.astro';
import Breadcrumb from '../../../../components/Breadcrumb.astro';
import courses from '../../../../data/coupons.json';

export async function getStaticPaths() {
  const subCategoryMap = new Map();

  // Group courses by category and subCategory
  courses.forEach(course => {
    const key = `${course.category}|||${course.subCategory}`;
    if (!subCategoryMap.has(key)) {
      subCategoryMap.set(key, {
        category: course.category,
        subCategory: course.subCategory,
        courses: []
      });
    }
    subCategoryMap.get(key).courses.push(course);
  });

  return Array.from(subCategoryMap.values()).map(({ category, subCategory, courses: subCourses }) => ({
    params: {
      category: category.toLowerCase().replace(/\s+/g, '-'),
      subCategory: subCategory.toLowerCase().replace(/\s+/g, '-').replace(/&/g, 'and').replace(/\//g, '-')
    },
    props: {
      category,
      subCategory,
      courses: subCourses
    }
  }));
}

const { category, subCategory, courses: subCourses } = Astro.props;

const title = `${subCategory} ${category} Courses - Best Udemy Coupons 2026`;
const description = `Discover the best ${subCategory} ${category} courses on Udemy with our verified coupons. Save up to 95% on premium courses with lifetime access and certificates.`;
const keywords = `${subCategory}, ${category}, udemy coupons, free courses, discount codes, ${category} certification, online learning`;
const canonical = `https://courseswyn.com/coupon/${category.toLowerCase().replace(/\s+/g, '-')}/${subCategory.toLowerCase().replace(/\s+/g, '-').replace(/&/g, 'and').replace(/\//g, '-')}`;

const structuredData = {
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": `${subCategory} ${category} Courses`,
  "description": description,
  "numberOfItems": subCourses.length,
  "itemListElement": (subCourses as any[]).slice(0, 20).map((course: any, index: number) => ({
    "@type": "ListItem",
    "position": index + 1,
    "item": {
      "@type": "Course",
      "name": course.title,
      "description": course.description,
      "url": `https://courseswyn.com/coupon/${course.slug}`,
      "provider": {
        "@type": "Organization",
        "name": "Udemy"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": course.rating,
        "reviewCount": course.students
      },
      "offers": {
        "@type": "Offer",
        "price": course.price.replace(/[^\d.-]/g, ''),
        "priceCurrency": "USD",
        "priceValidUntil": course.expiryDate
      }
    }
  }))
};
---

<Layout
  title={title}
  description={description}
  keywords={keywords}
  canonical={canonical}
  structuredData={structuredData}
>

<Breadcrumb
  category={category}
  subCategory={subCategory}
  isSubCategoryPage={true}
/>

<div class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-900 to-slate-800">

  <!-- Header Section -->
  <div class="bg-gradient-to-r from-slate-900 to-slate-800 border-b border-slate-700 py-12 mb-8">
    <div class="max-w-6xl mx-auto px-4">
      <h1 class="text-3xl lg:text-4xl font-bold text-white mb-4">
        {subCategory} {category} Courses - Best Udemy Coupons 2026
      </h1>
      <p class="text-slate-300 text-lg leading-relaxed mb-6">
        Master {subCategory} in {category} with our curated selection of premium Udemy courses.
        Get lifetime access to high-quality education with up to 95% OFF using our verified coupons.
      </p>

      <!-- Stats -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-gradient-to-r from-blue-600/20 to-blue-500/20 p-6 rounded-xl border border-blue-500/30">
          <div class="text-center">
            <div class="text-3xl font-bold text-blue-400 mb-2">{subCourses.length}</div>
            <div class="text-slate-300 font-medium">Courses Available</div>
          </div>
        </div>
        <div class="bg-gradient-to-r from-green-600/20 to-green-500/20 p-6 rounded-xl border border-green-500/30">
          <div class="text-center">
            <div class="text-3xl font-bold text-green-400 mb-2">
              {Math.round((subCourses as any[]).reduce((sum: number, course: any) => sum + parseFloat(course.rating), 0) / subCourses.length * 10) / 10}
            </div>
            <div class="text-slate-300 font-medium">Average Rating</div>
          </div>
        </div>
        <div class="bg-gradient-to-r from-purple-600/20 to-purple-500/20 p-6 rounded-xl border border-purple-500/30">
          <div class="text-center">
            <div class="text-3xl font-bold text-purple-400 mb-2">95%</div>
            <div class="text-slate-300 font-medium">Max Discount</div>
          </div>
        </div>
      </div>

      <!-- CTA -->
      <div class="text-center">
        <div class="inline-block bg-gradient-to-r from-red-500 via-pink-500 to-purple-600 p-6 rounded-2xl shadow-xl">
          <h2 class="text-white text-2xl font-bold mb-2">üéì Start Learning Today!</h2>
          <p class="text-white/90 mb-4">Get premium {subCategory} courses completely FREE with our coupons</p>
          <a href="#courses" class="inline-flex items-center gap-2 bg-white text-purple-600 font-bold py-3 px-6 rounded-lg hover:bg-gray-100 transition-colors">
            Browse Courses ‚Üì
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
            </svg>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Courses Grid -->
  <div id="courses" class="max-w-7xl mx-auto px-4 pb-16">
    <div class="mb-8">
      <h2 class="text-2xl font-bold text-white mb-2">Featured {subCategory} Courses</h2>
      <p class="text-slate-300">Handpicked courses to help you master {subCategory} in {category}</p>
    </div>

    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
      {(subCourses as any[]).map((course) => (
        <div class="bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-lg transition-all duration-200 overflow-hidden group">
          <div class="relative">
            <img
              src={course.image}
              alt={course.title}
              class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-200"
              loading="lazy"
            />
            <div class="absolute top-3 right-3 bg-red-500 text-white text-sm font-bold px-3 py-1 rounded-full shadow-lg">
              {course.discount} OFF
            </div>
            {course.verified && (
              <div class="absolute top-3 left-3 bg-green-500 text-white text-sm font-bold px-3 py-1 rounded-full shadow-lg">
                ‚úì Verified
              </div>
            )}
          </div>

          <div class="p-6">
            <h3 class="font-bold text-gray-900 mb-2 line-clamp-2 text-lg leading-tight group-hover:text-blue-600 transition-colors">
              <a href={`/coupon/${course.slug}`}>{course.title}</a>
            </h3>

            <p class="text-gray-600 text-sm mb-3 line-clamp-3">{course.description}</p>

            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center">
                <div class="flex mr-2">
                  {[...Array(5)].map((_, i) => (
                    <span class={`text-sm ${i < Math.floor(parseFloat(course.rating)) ? 'text-yellow-400' : 'text-gray-300'}`}>‚òÖ</span>
                  ))}
                </div>
                <span class="text-sm font-medium text-gray-900">{course.rating}</span>
                <span class="text-sm text-gray-500 ml-1">({course.students.toLocaleString()})</span>
              </div>
            </div>

            <div class="flex items-center justify-between mb-4">
              <div class="text-sm text-gray-500">
                <span class="font-medium">{course.duration}</span> ‚Ä¢ {course.level}
              </div>
            </div>

            <div class="flex items-center justify-between mb-4">
              <span class="text-2xl font-bold text-blue-600">{course.price}</span>
              <span class="text-sm text-gray-500 line-through">{course.originalPrice}</span>
            </div>

            <a
              href={`/coupon/${course.slug}`}
              class="block w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-bold py-3 px-4 rounded-lg text-center transition-all duration-200 transform hover:scale-105"
            >
              View Course Details
            </a>
          </div>
        </div>
      ))}
    </div>

    <!-- Why Choose Section -->
    <div class="bg-gradient-to-br from-slate-800 to-slate-900 border border-slate-700 rounded-xl shadow-sm p-8 mt-12">
      <h2 class="text-2xl font-bold text-white mb-6">Why Learn {subCategory}?</h2>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div class="text-center">
          <div class="w-16 h-16 bg-blue-500/20 border border-blue-500/30 rounded-full flex items-center justify-center mx-auto mb-4">
            <span class="text-2xl">üíº</span>
          </div>
          <h3 class="font-semibold text-white mb-2">Career Growth</h3>
          <p class="text-slate-300 text-sm">{subCategory} skills are in high demand across industries</p>
        </div>
        <div class="text-center">
          <div class="w-16 h-16 bg-green-500/20 border border-green-500/30 rounded-full flex items-center justify-center mx-auto mb-4">
            <span class="text-2xl">üéØ</span>
          </div>
          <h3 class="font-semibold text-white mb-2">Practical Skills</h3>
          <p class="text-slate-300 text-sm">Learn through hands-on projects and real-world applications</p>
        </div>
        <div class="text-center">
          <div class="w-16 h-16 bg-purple-500/20 border border-purple-500/30 rounded-full flex items-center justify-center mx-auto mb-4">
            <span class="text-2xl">üèÜ</span>
          </div>
          <h3 class="font-semibold text-white mb-2">Certification</h3>
          <p class="text-slate-300 text-sm">Earn recognized certificates to boost your professional profile</p>
        </div>
      </div>
    </div>

    <!-- About Section -->
    <div class="bg-gradient-to-br from-slate-800 to-slate-900 border border-slate-700 rounded-xl shadow-sm p-8 mt-8">
      <h2 class="text-2xl font-bold text-white mb-6">About {subCategory} in {category}</h2>
      <div class="prose prose-invert max-w-none">
        <p class="text-slate-300 leading-relaxed mb-4">
          {subCategory} is a specialized area within {category} that focuses on practical skills and knowledge essential for modern professionals.
          Our curated collection of Udemy courses in {subCategory} provides comprehensive training from beginner to advanced levels,
          ensuring you gain the expertise needed to excel in your career.
        </p>
        <p class="text-slate-300 leading-relaxed mb-4">
          These courses are taught by industry experts and include hands-on projects, real-world examples, and lifetime access to premium content.
          Whether you're looking to upskill, change careers, or simply expand your knowledge, our verified coupons make learning affordable and accessible.
        </p>
        <p class="text-gray-700 leading-relaxed">
          All courses feature professional certificates, video lectures, downloadable resources, and mobile access. Start your learning journey today with up to 95% savings!
        </p>
      </div>
    </div>

    <!-- FAQ Section -->
    <div class="bg-white border border-gray-200 rounded-xl shadow-sm p-8 mt-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-6">Frequently Asked Questions</h2>
      <div class="space-y-6">
        <div class="border-b border-gray-200 pb-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-2">Are these coupons verified?</h3>
          <p class="text-gray-600">Yes, all coupons are manually verified daily to ensure they work and provide the advertised discounts.</p>
        </div>
        <div class="border-b border-gray-200 pb-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-2">Do these courses include certificates?</h3>
          <p class="text-gray-600">Yes, all Udemy courses include professional certificates upon completion that you can share on LinkedIn and your resume.</p>
        </div>
        <div class="border-b border-gray-200 pb-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-2">Is lifetime access included?</h3>
          <p class="text-gray-600">Absolutely! Once enrolled, you get lifetime access to the course content, including future updates.</p>
        </div>
        <div class="pb-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-2">Can I access courses on mobile?</h3>
          <p class="text-gray-600">Yes, Udemy courses are fully accessible on mobile devices through the Udemy app or mobile browser.</p>
        </div>
      </div>
    </div>

    <!-- Related Categories -->
    <div class="bg-white border border-gray-200 rounded-xl shadow-sm p-8 mt-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-6">Explore More {category} Topics</h2>
      <div class="grid md:grid-cols-4 gap-4">
        {Array.from(new Set(courses.filter(c => c.category === category).map(c => c.subCategory)))
          .filter(sc => sc !== subCategory)
          .slice(0, 4)
          .map((relatedSub) => (
            <a
              href={`/coupon/${category.toLowerCase().replace(/\s+/g, '-')}/${relatedSub.toLowerCase().replace(/\s+/g, '-').replace(/&/g, 'and').replace(/\//g, '-')}`}
              class="block bg-gradient-to-br from-gray-50 to-gray-100 p-4 rounded-lg hover:shadow-md transition-all text-center"
            >
              <div class="text-lg font-semibold text-gray-900 mb-1">{relatedSub}</div>
              <div class="text-sm text-gray-600">View Courses ‚Üí</div>
            </a>
          ))}
      </div>
    </div>
  </div>
</div>
</Layout>