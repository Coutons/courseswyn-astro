---
import Layout from '../../layouts/Layout.astro';
import DealCard from '../../components/coupon/DealCard.astro';

const slugParam = Astro.params.slug ?? "";
const segments = typeof slugParam === 'string' ? slugParam.split('/').filter(Boolean) : [];

import coupons from '../../data/coupons.json';

// Pagination constants
const ITEMS_PER_PAGE = 12;

export async function getStaticPaths() {
  const paths = [
    { params: { slug: undefined } },
    ...coupons.map((c) => ({ params: { slug: c.slug } })),
  ];
  return paths;
}

// Get unique categories for filter
const categories = [...new Set(coupons.map(c => c.category))].sort();

// Helper functions
function formatDate(date: string | Date): string {
  return new Date(date).toLocaleDateString('en-US', { 
    year: 'numeric', 
    month: 'short', 
    day: 'numeric' 
  });
}

function getDaysUntilExpiry(expiryDate: string): number {
  const today = new Date();
  const expiry = new Date(expiryDate);
  const diffTime = expiry.getTime() - today.getTime();
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
  return diffDays;
}

function getPriceRangeLabel(range: string): string {
  const labels: Record<string, string> = {
    'free': 'FREE',
    'budget': '$1-$20',
    'standard': '$20-$100',
    'premium': '$100+'
  };
  return labels[range] || 'All Prices';
}

// Prepare coupon data as JSON for client-side filtering
const couponsJSON = JSON.stringify(coupons);
const totalCoupons = coupons.length;
const totalPages = Math.ceil(totalCoupons / ITEMS_PER_PAGE);
---

<script define:vars={{ couponsJSON, ITEMS_PER_PAGE }}>
  const couponsData = JSON.parse(couponsJSON);
  let filteredCoupons = [...couponsData];
  let currentCategory = 'all';
  let currentSort = 'newest';
  let currentPage = 1;
  let currentMinRating = 0;
  let currentPriceRange = 'all';

  window.filterCoupons = function(category) {
    currentCategory = category;
    currentPage = 1;
    applyFiltersAndSort();
    
    // Update button states
    document.querySelectorAll('[data-filter-category]').forEach(btn => {
      btn.classList.remove('opacity-75');
      if (btn.dataset.filterCategory === category) {
        btn.classList.add('opacity-75');
      }
    });

    // Update filter count
    const count = filteredCoupons.length;
    const display = document.getElementById('filter-count');
    if (display) {
      if (category === 'all') {
        display.textContent = `Showing all ${count} courses`;
      } else {
        display.textContent = `Showing ${count} ${category} courses`;
      }
    }
  };

  window.filterByPrice = function(range) {
    currentPriceRange = range;
    currentPage = 1;
    applyFiltersAndSort();
    
    document.querySelectorAll('[data-filter-price]').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.filterPrice === range);
    });
  };

  window.sortCoupons = function(sortBy) {
    currentSort = sortBy;
    currentPage = 1;
    applyFiltersAndSort();
  };

  window.goToPage = function(page) {
    const totalPages = Math.ceil(filteredCoupons.length / ITEMS_PER_PAGE);
    if (page >= 1 && page <= totalPages) {
      currentPage = page;
      window.scrollTo({ top: 0, behavior: 'smooth' });
      updateCouponsDisplay();
      updatePagination();
    }
  };

  function applyFiltersAndSort() {
    // Filter by category
    filteredCoupons = currentCategory === 'all' 
      ? [...couponsData]
      : couponsData.filter(c => c.category === currentCategory);

    // Sort by newest first
    filteredCoupons.sort((a, b) => new Date(b.addedDate) - new Date(a.addedDate));

    updateCouponsDisplay();
    updatePagination();
  }

  function updateCouponsDisplay() {
    const grid = document.getElementById('coupons-grid');
    if (!grid) return;

    const startIdx = (currentPage - 1) * ITEMS_PER_PAGE;
    const endIdx = startIdx + ITEMS_PER_PAGE;
    const pageItems = filteredCoupons.slice(startIdx, endIdx);

    // Get all coupon cards
    const cards = grid.querySelectorAll('[data-coupon-slug]');
    
    // Hide all cards
    cards.forEach(card => {
      card.style.display = 'none';
    });

    // Show only cards for current page
    pageItems.forEach(coupon => {
      const card = grid.querySelector(`[data-coupon-slug="${coupon.slug}"]`);
      if (card) {
        card.style.display = '';
      }
    });
  }

  function updatePagination() {
    const totalPages = Math.ceil(filteredCoupons.length / ITEMS_PER_PAGE);
    const paginationControls = document.getElementById('pagination-controls');
    
    if (paginationControls) {
      paginationControls.innerHTML = '';
      
      if (totalPages <= 1) return;

      // Previous button
      if (currentPage > 1) {
        const prevBtn = document.createElement('button');
        prevBtn.textContent = '← Previous';
        prevBtn.className = 'px-4 py-2 rounded-lg border border-white/10 hover:bg-white/5 text-white transition';
        prevBtn.onclick = () => window.goToPage(currentPage - 1);
        paginationControls.appendChild(prevBtn);
      }

      // Page numbers
      for (let i = 1; i <= totalPages; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.textContent = String(i);
        pageBtn.className = `px-3 py-2 rounded-lg transition ${
          i === currentPage 
            ? 'bg-mint-500/20 border border-mint-500/50 text-white' 
            : 'border border-white/10 hover:bg-white/5 text-white/70 hover:text-white'
        }`;
        pageBtn.onclick = () => window.goToPage(i);
        paginationControls.appendChild(pageBtn);
      }

      // Next button
      if (currentPage < totalPages) {
        const nextBtn = document.createElement('button');
        nextBtn.textContent = 'Next →';
        nextBtn.className = 'px-4 py-2 rounded-lg border border-white/10 hover:bg-white/5 text-white transition';
        nextBtn.onclick = () => window.goToPage(currentPage + 1);
        paginationControls.appendChild(nextBtn);
      }
    }
  }

  // Copy to clipboard
  window.copyCouponCode = function(code, button) {
    navigator.clipboard.writeText(code).then(() => {
      const originalText = button.textContent;
      button.textContent = '✓ Copied!';
      button.classList.add('!bg-green-500/20', '!border-green-500/50', '!text-green-400');
      setTimeout(() => {
        button.textContent = originalText;
        button.classList.remove('!bg-green-500/20', '!border-green-500/50', '!text-green-400');
      }, 2000);
    });
  };

  // Countdown timer
  window.updateCountdownTimer = function(expiryDate, elementId) {
    function countdown() {
      const now = new Date().getTime();
      const expiry = new Date(expiryDate).getTime();
      const distance = expiry - now;

      if (distance < 0) {
        document.getElementById(elementId).textContent = 'Expired';
        return;
      }

      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      
      if (days > 0) {
        document.getElementById(elementId).textContent = `${days}d ${hours}h left`;
      } else {
        document.getElementById(elementId).textContent = `${hours}h left`;
      }
    }

    countdown();
    setInterval(countdown, 60000); // Update every minute
  };

  // Initialize on load
  document.addEventListener('DOMContentLoaded', () => {
    applyFiltersAndSort();
    // Mark "All Categories" button as active
    document.querySelector('[data-filter-category="all"]')?.classList.add('opacity-75');
  });
</script>

{
  !segments.length ? (
    <Layout 
      title="Free Udemy Coupons & Deals - CoursesWyn" 
      description="2,500+ verified free Udemy coupons updated daily. Save up to 95% on premium courses. 100% free, no credit card required."
      structuredData={{
        "@context": "https://schema.org",
        "@graph": [
          {
            "@type": "CollectionPage",
            "name": "Free Udemy Coupons & Deals",
            "description": "2,500+ verified free Udemy coupons updated daily",
            "url": "https://courseswyn.com/coupon/",
            "mainEntity": {
              "@type": "AggregateOffer",
              "name": "Free Udemy Courses",
              "description": "Verified free Udemy coupons and deals",
              "price": "0",
              "priceCurrency": "USD",
              "availability": "https://schema.org/InStock",
              "url": "https://courseswyn.com/coupon/",
              "offerCount": coupons.length
            }
          }
        ]
      }}
    >
      <!-- Premium Header Section -->
      <section class="mb-16 relative">
        <!-- Background Decorative Elements -->
        <div class="absolute inset-0 -z-10">
          <div class="absolute top-0 left-1/4 w-72 h-72 bg-indigo-500/20 rounded-full blur-3xl animate-pulse"></div>
          <div class="absolute bottom-0 right-1/4 w-72 h-72 bg-purple-500/20 rounded-full blur-3xl animate-pulse" style="animation-delay: 1s;"></div>
        </div>

        <!-- Main Header Content -->
        <div class="relative">
          <!-- Badge -->
          <div class="inline-flex items-center gap-2 mb-6 px-4 py-2 rounded-full bg-gradient-to-r from-indigo-500/10 to-purple-500/10 border border-indigo-500/20">
            <span class="w-2 h-2 rounded-full bg-gradient-to-r from-indigo-400 to-purple-400 animate-pulse"></span>
            <span class="text-xs font-semibold text-indigo-300">Updated Daily</span>
          </div>

          <!-- Main Title -->
          <div class="mb-4">
            <h1 class="text-5xl md:text-6xl lg:text-7xl font-black text-white mb-2 leading-tight">
              Free Udemy<br />
              <span class="bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">Coupons & Deals</span>
            </h1>
          </div>

          <!-- Description with Icons -->
          <div class="grid md:grid-cols-3 gap-4 max-w-4xl">
            <!-- Description Text -->
            <div class="md:col-span-2">
              <p class="text-lg text-white/80 leading-relaxed mb-6">
                Discover {coupons.length}+ verified free Udemy coupons updated daily. Get premium courses for free — <span class="text-emerald-400 font-semibold">100% guaranteed working</span>.
              </p>

              <!-- Key Features -->
              <div class="flex flex-wrap gap-4">
                <div class="flex items-center gap-2 text-white/70">
                  <svg class="w-5 h-5 text-emerald-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                  <span class="text-sm font-medium">Verified Daily</span>
                </div>
                <div class="flex items-center gap-2 text-white/70">
                  <svg class="w-5 h-5 text-emerald-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                  <span class="text-sm font-medium">No Code Required</span>
                </div>
                <div class="flex items-center gap-2 text-white/70">
                  <svg class="w-5 h-5 text-emerald-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                  <span class="text-sm font-medium">Free Forever</span>
                </div>
              </div>
            </div>

            <!-- Stats Box -->
            <div class="bg-gradient-to-br from-slate-800/50 to-slate-900/50 rounded-2xl p-6 border border-white/10 backdrop-blur-sm">
              <div class="text-center">
                <div class="text-3xl font-black bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent mb-2">
                  {coupons.length}+
                </div>
                <p class="text-white/60 text-sm">Free Coupons</p>
              </div>
              <div class="mt-4 pt-4 border-t border-white/10">
                <div class="flex items-center justify-between text-xs text-white/50 mb-2">
                  <span>Success Rate</span>
                  <span class="font-semibold text-emerald-400">100%</span>
                </div>
                <div class="w-full bg-white/10 rounded-full h-1.5 overflow-hidden">
                  <div class="h-full bg-gradient-to-r from-emerald-500 to-emerald-400 w-full"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Filter Section - Clean & Modern Design -->
      <section class="mb-16 relative">
        <!-- Section Header with Premium Styling -->
        <div class="mb-8">
          <div class="flex items-center gap-3 mb-3">
            <div class="w-1 h-8 bg-gradient-to-b from-indigo-500 to-purple-500 rounded-full"></div>
            <h2 class="text-3xl md:text-4xl font-black text-white">Explore Courses</h2>
          </div>
          <p class="text-white/60 text-base max-w-2xl">Find the perfect course across multiple categories. Browse, filter, and discover your next learning journey with confidence.</p>
        </div>

        <!-- Category Filter with Modern Design -->
        <div class="bg-gradient-to-br from-slate-900/60 via-slate-800/40 to-slate-900/60 rounded-3xl p-8 border border-white/10 backdrop-blur-sm">
          <div class="flex items-center gap-3 mb-8">
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center shadow-lg shadow-indigo-500/50">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
              </svg>
            </div>
            <div class="flex-1">
              <h3 class="text-lg font-bold text-white">Categories</h3>
              <p class="text-xs text-white/50">Select a category to view courses</p>
            </div>
            <span class="text-sm font-bold text-indigo-400 bg-indigo-500/20 border border-indigo-500/30 px-4 py-2 rounded-full">{categories.length + 1} options</span>
          </div>

          <!-- Filter Buttons -->
          <div class="flex gap-2 flex-wrap">
            <!-- All Categories Button -->
            <button 
              class="group relative px-6 py-3 rounded-full text-sm font-semibold text-white transition-all duration-300 overflow-hidden shadow-lg hover:shadow-xl hover:shadow-indigo-500/50"
              data-filter-category="all"
              onclick="filterCoupons('all')"
              style="background: linear-gradient(135deg, rgb(79, 70, 229) 0%, rgb(139, 92, 246) 100%);"
            >
              <span class="relative z-10 flex items-center gap-2">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM15 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2h-2zM5 13a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM15 13a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2h-2z" />
                </svg>
                All Categories
              </span>
              <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent transform translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-500"></div>
            </button>

            <!-- Individual Category Buttons -->
            {categories.map(cat => (
              <button 
                class="group relative px-6 py-3 rounded-full text-sm font-medium text-white/80 hover:text-white transition-all duration-300 border border-white/20 hover:border-indigo-400/50 bg-white/5 hover:bg-indigo-500/10"
                data-filter-category={cat}
                onclick={`filterCoupons('${cat}')`}
              >
                <span class="relative z-10">{cat}</span>
                <div class="absolute inset-0 rounded-full bg-gradient-to-r from-indigo-500/0 via-indigo-500/10 to-indigo-500/0 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
              </button>
            ))}
          </div>

          <!-- Info Text -->
          <div class="mt-8 pt-8 border-t border-white/10 flex items-center justify-between text-xs text-white/50">
            <span class="flex items-center gap-2">
              <svg class="w-4 h-4 text-indigo-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2z" clip-rule="evenodd" />
              </svg>
              Click a category to browse courses
            </span>
            <span id="filter-count" class="font-semibold text-indigo-400">Showing all courses</span>
          </div>
        </div>
      </section>

      <!-- Coupons Grid -->
      <section class="deals-grid mb-12" id="coupons-grid">
        {coupons.map((c) => (
          <div data-coupon-slug={c.slug}>
            <DealCard
              title={c.title}
              description={c.description}
              image={c.image}
              price={c.price}
              originalPrice={c.originalPrice}
              discount={c.discount}
              url={c.url}
              provider={c.provider}
              category={c.category}
              rating={c.rating}
              students={c.students}
              verified={c.verified}
              expiryDate={c.expiryDate}
              slug={c.slug}
            />
          </div>
        ))}
      </section>

      <!-- Pagination Controls -->
      {totalPages > 1 && (
        <nav class="flex justify-center gap-2 mb-16 flex-wrap" id="pagination-controls">
          {Array.from({ length: totalPages }, (_, i) => i + 1).map(page => (
            <button 
              class={`px-4 py-2.5 rounded-lg font-semibold transition-all duration-300 ${
                page === 1
                  ? 'bg-gradient-to-br from-indigo-500/80 to-purple-500/80 text-white shadow-lg shadow-indigo-500/50 border border-indigo-400/30'
                  : 'border border-white/20 hover:border-indigo-400/50 bg-white/5 hover:bg-indigo-500/10 text-white/70 hover:text-white hover:shadow-lg'
              }`}
              onclick={`goToPage(${page})`}
            >
              {page}
            </button>
          ))}
        </nav>
      )}

      <!-- Info Section -->
      <section class="py-16 border-t border-white/10">
        <div class="grid md:grid-cols-3 gap-6 mb-12">
          <div class="bg-gradient-to-br from-slate-800/60 to-slate-900/60 rounded-2xl p-8 border border-white/10 backdrop-blur-sm text-center hover:shadow-lg hover:shadow-indigo-500/20 transition-all duration-300">
            <div class="text-5xl font-black bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent mb-3">{coupons.length}+</div>
            <div class="text-white/70 font-medium">Active Coupons</div>
          </div>
          <div class="bg-gradient-to-br from-slate-800/60 to-slate-900/60 rounded-2xl p-8 border border-white/10 backdrop-blur-sm text-center hover:shadow-lg hover:shadow-emerald-500/20 transition-all duration-300">
            <div class="text-5xl font-black bg-gradient-to-r from-emerald-400 to-teal-400 bg-clip-text text-transparent mb-3">100%</div>
            <div class="text-white/70 font-medium">Verified & Working</div>
          </div>
          <div class="bg-gradient-to-br from-slate-800/60 to-slate-900/60 rounded-2xl p-8 border border-white/10 backdrop-blur-sm text-center hover:shadow-lg hover:shadow-pink-500/20 transition-all duration-300">
            <div class="text-5xl font-black bg-gradient-to-r from-pink-400 to-rose-400 bg-clip-text text-transparent mb-3">Daily</div>
            <div class="text-white/70 font-medium">Updated Coupons</div>
          </div>
        </div>

        <!-- FAQ -->
        <div class="mt-16 pt-8 border-t border-white/10">
          <div class="flex items-center gap-3 mb-8">
            <div class="w-1 h-8 bg-gradient-to-b from-indigo-500 to-purple-500 rounded-full"></div>
            <h2 class="text-3xl md:text-4xl font-black text-white">Common Questions</h2>
          </div>
          <div class="max-w-3xl mx-auto space-y-4">
            <details class="group bg-gradient-to-br from-slate-800/40 to-slate-900/40 rounded-xl border border-white/10 backdrop-blur-sm overflow-hidden hover:border-indigo-500/30 transition-all duration-300">
              <summary class="flex items-center justify-between p-6 cursor-pointer hover:bg-white/5 transition font-semibold text-white">
                How do these free coupons work?
                <span class="text-indigo-400 group-open:rotate-180 transition-transform duration-300 font-bold">▼</span>
              </summary>
              <div class="p-6 pt-0 text-white/70 border-t border-white/10 mt-2">
                Click on any coupon to apply the discount to your Udemy cart. The course will show as free before checkout. All coupons are verified daily to ensure they work.
              </div>
            </details>

            <details class="group bg-gradient-to-br from-slate-800/40 to-slate-900/40 rounded-xl border border-white/10 backdrop-blur-sm overflow-hidden hover:border-indigo-500/30 transition-all duration-300">
              <summary class="flex items-center justify-between p-6 cursor-pointer hover:bg-white/5 transition font-semibold text-white">
                Do I need to sign up or use a code?
                <span class="text-indigo-400 group-open:rotate-180 transition-transform duration-300 font-bold">▼</span>
              </summary>
              <div class="p-6 pt-0 text-white/70 border-t border-white/10 mt-2">
                No signup required on CoursesWyn. Just click the button, it redirects to Udemy with the coupon pre-applied. You only need a free Udemy account to enroll.
              </div>
            </details>

            <details class="group bg-gradient-to-br from-slate-800/40 to-slate-900/40 rounded-xl border border-white/10 backdrop-blur-sm overflow-hidden hover:border-indigo-500/30 transition-all duration-300">
              <summary class="flex items-center justify-between p-6 cursor-pointer hover:bg-white/5 transition font-semibold text-white">
                How long do free coupons last?
                <span class="text-indigo-400 group-open:rotate-180 transition-transform duration-300 font-bold">▼</span>
              </summary>
              <div class="p-6 pt-0 text-white/70 border-t border-white/10 mt-2">
                Free coupons vary in duration (usually 1-30 days). Once enrolled, you keep the course forever. Our coupons are verified daily, so if one expires we replace it with a new one.
              </div>
            </details>
          </div>
        </div>
      </section>
    </Layout>
  ) : (
    // Show individual coupon detail if slug matches
    (() => {
      const slug = segments.join('/');
      const entry = coupons.find((c) => c.slug === slug);
      
      if (!entry) {
        return (
          <Layout title="Coupon Not Found - CoursesWyn" description="The coupon you're looking for doesn't exist or has been removed.">
            <div class="text-center py-16">
              <h1 class="text-4xl font-bold text-white mb-3">404 - Coupon Not Found</h1>
              <p class="text-white/70 mb-8">This coupon does not exist or has been removed. Check our latest deals below.</p>
              <a href="/coupon/" class="inline-block bg-mint-500 hover:bg-mint-600 text-black font-semibold px-6 py-3 rounded-lg transition">
                Browse All Deals
              </a>
            </div>
          </Layout>
        );
      }

      // Get related coupons (same category)
      const relatedCoupons = coupons
        .filter(c => c.category === entry.category && c.slug !== entry.slug)
        .slice(0, 3);

      const detailSchema = {
        "@context": "https://schema.org",
        "@graph": [
          {
            "@type": "BreadcrumbList",
            "itemListElement": [
              {
                "@type": "ListItem",
                "position": 1,
                "name": "Home",
                "item": "https://courseswyn.com/"
              },
              {
                "@type": "ListItem",
                "position": 2,
                "name": "Coupons",
                "item": "https://courseswyn.com/coupon/"
              },
              {
                "@type": "ListItem",
                "position": 3,
                "name": entry.title,
                "item": `https://courseswyn.com/coupon/${entry.slug}/`
              }
            ]
          },
          {
            "@type": "Product",
            "name": entry.title,
            "description": entry.description,
            "image": entry.image,
            "brand": {
              "@type": "Brand",
              "name": entry.provider
            },
            "offers": {
              "@type": "Offer",
              "url": entry.url,
              "priceCurrency": "USD",
              "price": entry.price.replace(/[^\d.-]/g, ''),
              "availability": "https://schema.org/InStock",
              "category": entry.category
            },
            "aggregateRating": {
              "@type": "AggregateRating",
              "ratingValue": entry.rating,
              "reviewCount": entry.students
            }
          }
        ]
      };

      return (
        <Layout 
          title={`${entry.title} - Free Udemy Coupon`}
          description={entry.description}
          structuredData={detailSchema}
        >
          <!-- Breadcrumb Navigation -->
          <nav class="flex items-center gap-2 text-sm text-white/60 mb-8">
            <a href="/" class="hover:text-white transition">Home</a>
            <span>/</span>
            <a href="/coupon/" class="hover:text-white transition">Coupons</a>
            <span>/</span>
            <span class="text-white">{entry.title}</span>
          </nav>

          <!-- Detail Article -->
          <article class="mb-20">
            <!-- Hero Section -->
            <header class="mb-12">
              <div class="mb-4 flex gap-2 flex-wrap items-center">
                {entry.verified && (
                  <div class="inline-block px-3 py-1 rounded-full bg-green-500/20 border border-green-500/50 text-green-400 text-sm font-semibold">
                    ✓ Verified ({formatDate(entry.verifiedAt)})
                  </div>
                )}
                <div class="inline-block px-3 py-1 rounded-full bg-mint-500/20 border border-mint-500/50 text-mint-400 text-sm font-semibold">
                  Added {formatDate(entry.addedDate)}
                </div>
              </div>
              <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">{entry.title}</h1>
              <p class="text-lg text-white/70 max-w-2xl">{entry.description}</p>
            </header>

            <!-- Image + Sidebar -->
            <div class="grid md:grid-cols-3 gap-8 mb-12">
              <!-- Image + Content -->
              <div class="md:col-span-2">
                <!-- Image with Badges -->
                <div class="relative mb-8">
                  <img 
                    src={entry.image} 
                    alt={entry.title} 
                    class="w-full h-96 object-cover rounded-2xl border border-white/10 shadow-lg" 
                    loading="eager"
                  />
                  
                  <!-- Badges Overlay -->
                  <div class="absolute top-4 right-4 flex flex-col gap-2">
                    {entry.level && (
                      <span class="bg-blue-500/90 text-white text-xs font-bold px-3 py-1 rounded-full backdrop-blur-sm">
                        {entry.level}
                      </span>
                    )}
                    {entry.hasLifetimeAccess && (
                      <span class="bg-green-500/90 text-white text-xs font-bold px-3 py-1 rounded-full backdrop-blur-sm flex items-center gap-1">
                        ♾ Lifetime Access
                      </span>
                    )}
                  </div>

                  <!-- Duration Badge Bottom Left -->
                  {entry.duration && (
                    <div class="absolute bottom-4 left-4 bg-black/70 text-white text-xs font-semibold px-3 py-2 rounded-full backdrop-blur-sm flex items-center gap-1">
                      ⏱ {entry.duration}
                    </div>
                  )}
                </div>

                <!-- About This Course -->
                <section class="mb-16">
                  <div class="flex items-center gap-3 mb-8">
                    <div class="w-1 h-8 bg-gradient-to-b from-indigo-500 to-purple-500 rounded-full"></div>
                    <h2 class="text-3xl font-black text-white">About This Course</h2>
                  </div>
                  
                  {entry.subtitle && (
                    <p class="text-lg bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent font-bold mb-8">{entry.subtitle}</p>
                  )}
                  
                  <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    {entry.totalLectures && (
                      <div class="bg-gradient-to-br from-slate-800/60 to-slate-900/60 rounded-xl p-4 border border-white/10 backdrop-blur-sm text-center hover:shadow-lg hover:shadow-indigo-500/20 transition-all">
                        <div class="text-2xl font-black bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">{entry.totalLectures}</div>
                        <div class="text-xs text-white/60 mt-2 font-medium">Lectures</div>
                      </div>
                    )}
                    <div class="bg-gradient-to-br from-slate-800/60 to-slate-900/60 rounded-xl p-4 border border-white/10 backdrop-blur-sm text-center hover:shadow-lg hover:shadow-indigo-500/20 transition-all">
                      <div class="text-2xl font-black bg-gradient-to-r from-emerald-400 to-teal-400 bg-clip-text text-transparent">{entry.duration}</div>
                      <div class="text-xs text-white/60 mt-2 font-medium">Duration</div>
                    </div>
                    {entry.language && (
                      <div class="bg-gradient-to-br from-slate-800/60 to-slate-900/60 rounded-xl p-4 border border-white/10 backdrop-blur-sm text-center hover:shadow-lg hover:shadow-pink-500/20 transition-all">
                        <div class="text-sm font-black bg-gradient-to-r from-pink-400 to-rose-400 bg-clip-text text-transparent">{entry.language}</div>
                        <div class="text-xs text-white/60 mt-2 font-medium">Language</div>
                      </div>
                    )}
                    <div class="bg-gradient-to-br from-slate-800/60 to-slate-900/60 rounded-xl p-4 border border-white/10 backdrop-blur-sm text-center hover:shadow-lg hover:shadow-cyan-500/20 transition-all">
                      <div class="text-sm font-black bg-gradient-to-r from-cyan-400 to-blue-400 bg-clip-text text-transparent">{entry.level}</div>
                      <div class="text-xs text-white/60 mt-2 font-medium">Level</div>
                    </div>
                  </div>

                  <p class="text-white/70 leading-relaxed mb-4">
                    <strong>What You'll Learn:</strong> This comprehensive {entry.category.toLowerCase()} course on {entry.provider} has been rated <strong>{entry.rating} out of 5 stars</strong> by <strong>{entry.students.toLocaleString()} students</strong>. The course covers essential skills and practical techniques designed for {entry.level.toLowerCase()} learners looking to advance their knowledge in this field.
                  </p>

                  <p class="text-white/70 leading-relaxed mb-4">
                    <strong>Why Enroll:</strong> This course is currently available for <strong>FREE</strong> through an exclusive verified coupon. After enrolling, you'll have <strong>lifetime access</strong> to all course materials, video lectures, downloadable resources, and quizzes. No expiration date on your enrollment means you can learn at your own pace.
                  </p>

                  <p class="text-white/70 leading-relaxed">
                    <strong>How to Get Started:</strong> Simply click the "Claim Free Course" button below to apply the coupon to your Udemy cart, then complete the free enrollment. The discount is automatically applied — no coupon code entry needed. You only need a free Udemy account to get started.
                  </p>
                </section>

                <!-- Course FAQs -->
                <section class="mb-16 border-t border-white/10 pt-12">
                  <div class="flex items-center gap-3 mb-8">
                    <div class="w-1 h-8 bg-gradient-to-b from-indigo-500 to-purple-500 rounded-full"></div>
                    <h2 class="text-3xl font-black text-white">Frequently Asked Questions</h2>
                  </div>
                  <div class="space-y-4">
                    <!-- FAQ: What will I learn -->
                    <details class="group bg-gradient-to-br from-slate-800/40 to-slate-900/40 rounded-xl border border-white/10 backdrop-blur-sm overflow-hidden hover:border-indigo-500/30 transition-all duration-300">
                      <summary class="flex items-center justify-between p-6 cursor-pointer hover:bg-white/5 transition font-semibold text-white">
                        What are the main topics covered in this course?
                        <span class="text-indigo-400 group-open:rotate-180 transition-transform duration-300 font-bold">▼</span>
                      </summary>
                      <div class="p-6 pt-0 text-white/70 border-t border-white/10 mt-2">
                        <p class="mb-3">{entry.description}</p>
                        <p>You'll gain hands-on experience in {entry.category.toLowerCase()} and learn industry-standard practices that you can immediately apply to your projects and career growth.</p>
                      </div>
                    </details>

                    <!-- FAQ: Course level -->
                    <details class="group bg-gradient-to-br from-slate-800/40 to-slate-900/40 rounded-xl border border-white/10 backdrop-blur-sm overflow-hidden hover:border-indigo-500/30 transition-all duration-300">
                      <summary class="flex items-center justify-between p-6 cursor-pointer hover:bg-white/5 transition font-semibold text-white">
                        Who should take this course?
                        <span class="text-indigo-400 group-open:rotate-180 transition-transform duration-300 font-bold">▼</span>
                      </summary>
                      <div class="p-6 pt-0 text-white/70 border-t border-white/10 mt-2">
                        This course is designed for {entry.level.toLowerCase()} learners. {entry.level === 'Beginner' ? 'No prior experience is required. The course starts with fundamentals and gradually builds up complexity, making it perfect for anyone new to this field.' : entry.level === 'Intermediate' ? 'You should have basic foundational knowledge of the subject. This course assumes some prior understanding and builds upon it with more advanced concepts.' : 'This course is for advanced learners with strong foundational knowledge. It covers complex topics and advanced techniques for experienced professionals.'} Regardless of where you are in your learning journey, you'll find valuable content tailored to your level.
                      </div>
                    </details>

                    <!-- FAQ: Course duration -->
                    <details class="group bg-gradient-to-br from-slate-800/40 to-slate-900/40 rounded-xl border border-white/10 backdrop-blur-sm overflow-hidden hover:border-indigo-500/30 transition-all duration-300">
                      <summary class="flex items-center justify-between p-6 cursor-pointer hover:bg-white/5 transition font-semibold text-white">
                        How much time do I need to dedicate to complete this course?
                        <span class="text-indigo-400 group-open:rotate-180 transition-transform duration-300 font-bold">▼</span>
                      </summary>
                      <div class="p-6 pt-0 text-white/70 border-t border-white/10 mt-2">
                        The total course content is approximately {entry.duration}. However, your actual completion time depends on your pace and learning style. Some students complete the course faster, while others prefer to spend more time on practice and projects. With lifetime access, you can learn at your own speed and revisit lessons whenever needed.
                      </div>
                    </details>

                    <!-- FAQ: Certificate -->
                    <details class="group bg-gradient-to-br from-slate-800/40 to-slate-900/40 rounded-xl border border-white/10 backdrop-blur-sm overflow-hidden hover:border-indigo-500/30 transition-all duration-300">
                      <summary class="flex items-center justify-between p-6 cursor-pointer hover:bg-white/5 transition font-semibold text-white">
                        Do I receive a certificate upon completion?
                        <span class="text-indigo-400 group-open:rotate-180 transition-transform duration-300 font-bold">▼</span>
                      </summary>
                      <div class="p-6 pt-0 text-white/70 border-t border-white/10 mt-2">
                        Yes! Upon completion, you'll receive a certificate of completion from {entry.provider}. This recognized credential can be added to your LinkedIn profile, resume, and portfolio to demonstrate your expertise and commitment to professional development to employers and clients.
                      </div>
                    </details>

                    <!-- FAQ: Lifetime access -->
                    <details class="group bg-gradient-to-br from-slate-800/40 to-slate-900/40 rounded-xl border border-white/10 backdrop-blur-sm overflow-hidden hover:border-indigo-500/30 transition-all duration-300">
                      <summary class="flex items-center justify-between p-6 cursor-pointer hover:bg-white/5 transition font-semibold text-white">
                        What kind of access will I have to the course materials?
                        <span class="text-indigo-400 group-open:rotate-180 transition-transform duration-300 font-bold">▼</span>
                      </summary>
                      <div class="p-6 pt-0 text-white/70 border-t border-white/10 mt-2">
                        You get unlimited lifetime access to all course materials, including video lectures, downloadable resources, source code, and quizzes. There's no expiration date on your enrollment. You can revisit the course anytime, stay updated with new content, and refresh your knowledge as needed.
                      </div>
                    </details>

                    <!-- FAQ: Instructor support -->
                    <details class="group bg-gradient-to-br from-slate-800/40 to-slate-900/40 rounded-xl border border-white/10 backdrop-blur-sm overflow-hidden hover:border-indigo-500/30 transition-all duration-300">
                      <summary class="flex items-center justify-between p-6 cursor-pointer hover:bg-white/5 transition font-semibold text-white">
                        Can I get help if I have questions?
                        <span class="text-indigo-400 group-open:rotate-180 transition-transform duration-300 font-bold">▼</span>
                      </summary>
                      <div class="p-6 pt-0 text-white/70 border-t border-white/10 mt-2">
                        Absolutely! You'll have access to the {entry.provider} community where you can ask questions and get answers from the instructor and fellow students. The active community provides peer support, and most questions are answered promptly. You'll benefit from collaborative learning with thousands of students worldwide.
                      </div>
                    </details>

                    <!-- FAQ: Quality and rating -->
                    <details class="group bg-gradient-to-br from-slate-800/40 to-slate-900/40 rounded-xl border border-white/10 backdrop-blur-sm overflow-hidden hover:border-indigo-500/30 transition-all duration-300">
                      <summary class="flex items-center justify-between p-6 cursor-pointer hover:bg-white/5 transition font-semibold text-white">
                        How is the course quality assessed?
                        <span class="text-indigo-400 group-open:rotate-180 transition-transform duration-300 font-bold">▼</span>
                      </summary>
                      <div class="p-6 pt-0 text-white/70 border-t border-white/10 mt-2">
                        This course has earned a {entry.rating} out of 5 stars rating from {entry.students.toLocaleString()} student reviews. These ratings reflect the course's effectiveness, instructor expertise, content quality, and overall value. High ratings indicate that students found the course engaging, practical, and successful in achieving learning objectives.
                      </div>
                    </details>

                    <!-- FAQ: Free coupon -->
                    <details class="group bg-gradient-to-br from-slate-800/40 to-slate-900/40 rounded-xl border border-white/10 backdrop-blur-sm overflow-hidden hover:border-indigo-500/30 transition-all duration-300">
                      <summary class="flex items-center justify-between p-6 cursor-pointer hover:bg-white/5 transition font-semibold text-white">
                        How can I access this course for free?
                        <span class="text-indigo-400 group-open:rotate-180 transition-transform duration-300 font-bold">▼</span>
                      </summary>
                      <div class="p-6 pt-0 text-white/70 border-t border-white/10 mt-2">
                        Course instructors on {entry.provider} periodically offer free access through limited-time coupons and promotions. This course is currently available for free with a verified coupon (valid until {formatDate(entry.expiryDate)}). Simply click "Claim Free Course" to apply the coupon and enroll. No credit card is required, and you get the same full access as paying students.
                      </div>
                    </details>

                    <!-- FAQ: How to enroll -->
                    <details class="group bg-gradient-to-br from-slate-800/40 to-slate-900/40 rounded-xl border border-white/10 backdrop-blur-sm overflow-hidden hover:border-indigo-500/30 transition-all duration-300">
                      <summary class="flex items-center justify-between p-6 cursor-pointer hover:bg-white/5 transition font-semibold text-white">
                        How do I get started with enrollment?
                        <span class="text-indigo-400 group-open:rotate-180 transition-transform duration-300 font-bold">▼</span>
                      </summary>
                      <div class="p-6 pt-0 text-white/70 border-t border-white/10 mt-2">
                        Getting started is simple: Click the "Claim Free Course" button, which takes you to {entry.provider} with the coupon pre-applied. You'll see the course price as free in your cart. Complete the enrollment process with your {entry.provider} account (create one if you don't have it), and you'll immediately get access to all course materials.
                      </div>
                    </details>
                  </div>
                </section>
              </div>

              <!-- Sidebar -->
              <div class="space-y-6">
                <!-- Price Card -->
                <div class="bg-gradient-to-br from-slate-800/60 to-slate-900/60 rounded-2xl border border-white/10 backdrop-blur-sm p-8 hover:shadow-lg hover:shadow-indigo-500/20 transition-all duration-300">
                  <div class="text-xs text-white/50 font-semibold uppercase tracking-wider mb-3">{entry.provider}</div>
                  <div class="text-5xl font-black bg-gradient-to-r from-emerald-400 to-teal-400 bg-clip-text text-transparent mb-2">{entry.price}</div>
                  <div class="text-white/60 line-through text-lg mb-4">{entry.originalPrice}</div>
                  <div class="inline-block text-sm font-bold bg-gradient-to-r from-rose-500 to-pink-500 text-white px-4 py-2 rounded-full mb-6">{entry.discount} OFF</div>
                  
                  <!-- Expiry Timer -->
                  <div class="text-sm font-semibold bg-gradient-to-r from-yellow-500/20 to-orange-500/20 text-yellow-300 border border-yellow-500/30 rounded-lg p-4 mb-6 backdrop-blur-sm">
                    ⏱ <span id={`timer-${entry.slug}`} class="font-bold">{getDaysUntilExpiry(entry.expiryDate)}d left</span> to claim this offer
                  </div>

                  <script is:inline define:vars={{ expiryDate: entry.expiryDate, slug: entry.slug }}>
                    window.updateCountdownTimer(expiryDate, `timer-${slug}`);
                  </script>
                  
                  <!-- CTA Button -->
                  <a 
                    href={entry.url} 
                    target="_blank"
                    rel="nofollow noopener noreferrer"
                    class="group block w-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:shadow-lg hover:shadow-emerald-500/50 text-white font-bold py-4 rounded-lg transition text-center mb-6 relative overflow-hidden"
                  >
                    <span class="relative z-10 flex items-center justify-center gap-2">
                      Claim Free Course
                      <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                      </svg>
                    </span>
                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent transform translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-500"></div>
                  </a>

                  <!-- Copy Coupon Code -->
                  {entry.couponCode && (
                    <div class="flex gap-2 mb-4">
                      <div class="flex-1 bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-sm text-white/80 flex items-center justify-between overflow-hidden font-mono">
                        <code>{entry.couponCode}</code>
                      </div>
                      <button 
                        onclick={`copyCouponCode('${entry.couponCode}', this)`}
                        class="px-4 py-3 rounded-lg border border-white/20 hover:border-indigo-400/50 hover:bg-indigo-500/10 text-white/70 hover:text-white transition text-sm font-semibold"
                      >
                        Copy
                      </button>
                    </div>
                  )}

                  <div class="text-xs text-white/50 text-center italic">
                    Direct link applies coupon automatically — no code needed
                  </div>
                </div>

                <!-- Rating -->
                <div class="bg-gradient-to-br from-slate-800/60 to-slate-900/60 rounded-2xl border border-white/10 backdrop-blur-sm p-8 hover:shadow-lg hover:shadow-yellow-500/20 transition-all duration-300">
                  <div class="flex items-center gap-3 mb-4">
                    <div class="text-4xl font-black bg-gradient-to-r from-yellow-400 to-amber-400 bg-clip-text text-transparent">{entry.rating}</div>
                    <div class="flex gap-1">
                      {[...Array(5)].map((_, i) => (
                        <span class={`text-2xl ${i < Math.round(entry.rating) ? 'text-yellow-400' : 'text-white/20'}`}>★</span>
                      ))}
                    </div>
                  </div>
                  <div class="text-sm text-white/60 font-medium">
                    {entry.students.toLocaleString()} students enrolled
                  </div>
                </div>

                <!-- Info -->
                <div class="bg-gradient-to-br from-slate-800/60 to-slate-900/60 rounded-2xl border border-white/10 backdrop-blur-sm p-8 space-y-6 hover:shadow-lg hover:shadow-blue-500/20 transition-all duration-300">
                  <div class="border-b border-white/10 pb-4">
                    <div class="text-xs text-white/50 uppercase font-bold tracking-wider mb-2">Category</div>
                    <div class="font-bold text-white text-lg bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">{entry.category}</div>
                  </div>
                  <div class="border-b border-white/10 pb-4">
                    <div class="text-xs text-white/50 uppercase font-bold tracking-wider mb-2">Type</div>
                    <div class="font-bold text-white flex items-center gap-2">
                      <span class="w-2 h-2 rounded-full bg-emerald-400"></span>
                      Free Coupon
                    </div>
                  </div>
                  <div class="border-b border-white/10 pb-4">
                    <div class="text-xs text-white/50 uppercase font-bold tracking-wider mb-2">Expires</div>
                    <div class="font-semibold text-white/80">{formatDate(entry.expiryDate)}</div>
                  </div>
                  <div>
                    <div class="text-xs text-white/50 uppercase font-bold tracking-wider mb-2">Price Range</div>
                    <div class="inline-block bg-gradient-to-r from-cyan-500/20 to-blue-500/20 border border-cyan-500/30 text-cyan-300 px-3 py-1 rounded-full text-sm font-semibold">{getPriceRangeLabel(entry.priceRange)}</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Related Coupons -->
            {relatedCoupons.length > 0 && (
              <section class="mb-16 border-t border-white/10 pt-12">
                <div class="flex items-center gap-3 mb-8">
                  <div class="w-1 h-8 bg-gradient-to-b from-indigo-500 to-purple-500 rounded-full"></div>
                  <h2 class="text-3xl font-black text-white">Similar Deals in {entry.category}</h2>
                </div>
                <div class="deals-grid">
                  {relatedCoupons.map((c) => (
                    <DealCard
                      title={c.title}
                      description={c.description}
                      image={c.image}
                      price={c.price}
                      originalPrice={c.originalPrice}
                      discount={c.discount}
                      url={c.url}
                      provider={c.provider}
                      category={c.category}
                      rating={c.rating}
                      students={c.students}
                      verified={c.verified}
                      expiryDate={c.expiryDate}
                      slug={c.slug}
                    />
                  ))}
                </div>
              </section>
            )}
          </article>
        </Layout>
      );
    })()
  )
}
