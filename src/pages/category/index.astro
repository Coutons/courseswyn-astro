---
import MainLayout from "../../layouts/MainLayout.astro";
import coupons from "../../data/coupons.json";

// Category icons for navigation
const categoryIcons: Record<string, string> = {
  "IT & Software": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-database"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5V19A9 3 0 0 0 21 19V5"/><path d="M3 12A9 3 0 0 0 21 12"/></svg>',
  "Web Development": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-code"><polyline points="16 18 2 22 6 12"/><line x1="23" y1="6" x2="16" y2="6"/><line x1="8" y1="22" x2="16" y2="22"/></svg>',
  "Data Science": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-database"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5V19A9 3 0 0 0 21 19V5"/><path d="M3 12A9 3 0 0 0 21 12"/></svg>',
  "Business": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-briefcase"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>',
  "Design": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-palette"><circle cx="13.5" cy="6.5" r=".5"/><circle cx="17.5" cy="10.5" r=".5"/><circle cx="8.5" cy="7.5" r=".5"/><circle cx="6.5" cy="12.5" r=".5"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c1.89 0 3.67-.5 5.27-1.34"/><path d="m22 2-1 1 1"/></svg>',
  "Marketing": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-megaphone"><path d="m18 8 1.5 1.5"/><path d="m21 3-9-1-1-8 2v8c0 4.5 2 9 9 9s9-4.5 9-9"/><path d="M18 8a2 2 0 0 1 2 2v0a2 2 0 0 1-2 2h0a2 2 0 0 1-2-2v0a2 2 0 0 1 2-2z"/></svg>',
  "Personal Development": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-target"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>',
  "Photography & Video": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-camera"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6a2 2 0 0 1 2 2v4"/><circle cx="13" cy="19" r="2"/><circle cx="13" cy="19" r="2"/></svg>'
};

// Get all unique categories from coupons.json data
const categories = new Set<string>();

coupons.forEach((coupon: any) => {
  if (coupon.category) {
    // Convert to slug format (lowercase, hyphenated, handle & properly)
    const categorySlug = coupon.category.toLowerCase()
      .replace(/\s+/g, '-')
      .replace(/&amp;/g, '')
      .replace(/&/g, '-and-')
      .replace(/--/g, '-');
    categories.add(categorySlug);
  }
  if (coupon.subcategory) {
    // Convert to slug format (lowercase, hyphenated, handle & properly)
    const subcategorySlug = coupon.subcategory.toLowerCase()
      .replace(/\s+/g, '-')
      .replace(/&amp;/g, '')
      .replace(/&/g, '-and-')
      .replace(/--/g, '-');
    categories.add(subcategorySlug);
  }
});

// Define expected category slugs based on actual data that exists
const expectedCategories = [
  'it-and-software', 'web-development', 'data-science', 'business', 'design',
  'marketing', 'personal-development', 'photography-and-video'
];

// Filter to only expected categories that have actual data
const validCategories = expectedCategories.filter(cat => categories.has(cat));

// Get category info based on actual data from coupons.json
function getCategoryInfo(categorySlug: string) {
  const categoryMap: Record<string, { name: string; icon: string; description: string }> = {
    'it-and-software': {
      name: 'IT & Software',
      icon: categoryIcons["IT & Software"],
      description: 'Master IT infrastructure, software development, cybersecurity, and system administration.'
    },
    'web-development': {
      name: 'Web Development',
      icon: categoryIcons["Web Development"],
      description: 'Learn modern web development with React, JavaScript, HTML, CSS, and frontend frameworks.'
    },
    'data-science': {
      name: 'Data Science',
      icon: categoryIcons["Data Science"],
      description: 'Master data analysis, machine learning, data visualization, and big data technologies.'
    },
    'business': {
      name: 'Business',
      icon: categoryIcons["Business"],
      description: 'Develop business skills, entrepreneurship, management, and leadership expertise.'
    },
    'design': {
      name: 'Design',
      icon: categoryIcons["Design"],
      description: 'Master graphic design, UI/UX design, web design, and creative skills.'
    },
    'marketing': {
      name: 'Marketing',
      icon: categoryIcons["Marketing"],
      description: 'Learn digital marketing, social media marketing, SEO, and growth strategies.'
    },
    'personal-development': {
      name: 'Personal Development',
      icon: categoryIcons["Personal Development"],
      description: 'Improve productivity, communication skills, time management, and personal growth.'
    },
    'photography-and-video': {
      name: 'Photography & Video',
      icon: categoryIcons["Photography & Video"],
      description: 'Master photography, videography, photo editing, and video production skills.'
    }
  };
  
  return categoryMap[categorySlug] || {
    name: categorySlug.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
    icon: 'ðŸ“š',
    description: `Find free courses in ${categorySlug.replace(/-/g, ' ')}`
  };
}

// Get course count for each category
const categoryData = validCategories.map(categorySlug => {
  const categoryInfo = getCategoryInfo(categorySlug);
  const categoryCourses = coupons.filter((coupon: any) => {
    const categoryLower = coupon.category?.toLowerCase() || '';
    const subcategoryLower = coupon.subcategory?.toLowerCase() || '';
    
    // Convert category slug to match actual data format
    const categoryMap: Record<string, string> = {
      'it-and-software': 'it & software',
      'web-development': 'web development', 
      'data-science': 'data science',
      'business': 'business',
      'design': 'design',
      'marketing': 'marketing',
      'personal-development': 'personal development',
      'photography-and-video': 'photography & video'
    };
    
    const expectedCategory = categoryMap[categorySlug] || categorySlug.replace(/-/g, ' ');
    
    // Check both category and subcategory, handle HTML encoded ampersand
    return categoryLower === expectedCategory || 
           subcategoryLower === expectedCategory ||
           categoryLower.includes(expectedCategory) ||
           subcategoryLower.includes(expectedCategory) ||
           categoryLower.includes(expectedCategory.replace('&', '&amp;')) ||
           subcategoryLower.includes(expectedCategory.replace('&', '&amp;'));
  });
  
  return {
    ...categoryInfo,
    slug: categorySlug,
    courseCount: categoryCourses.length
  };
});

// SEO data
const pageTitle = `All Course Categories - Free Udemy Coupons | CoursesWyn`;
const pageDescription = `Browse ${validCategories.length} course categories with ${coupons.length}+ free Udemy coupons. Find verified courses in IT, Web Development, Data Science, Business, Design, Marketing, and more.`;

// Structured data
const categoriesSchema = {
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "All Course Categories",
  "description": pageDescription,
  "url": "https://courseswyn.com/category/",
  "mainEntity": {
    "@type": "ItemList",
    "name": "Course Categories",
    "description": pageDescription,
    "numberOfItems": validCategories.length,
    "itemListElement": categoryData.map((category: any, index: number) => ({
      "@type": "ListItem",
      "position": index + 1,
      "name": category.name,
      "description": category.description,
      "url": `https://courseswyn.com/category/${category.slug}`
    }))
  }
};
---

<MainLayout 
  title={pageTitle}
  description={pageDescription}
  canonical="https://courseswyn.com/category/"
  ogImage="https://courseswyn.com/og-categories.jpg"
  structuredData={categoriesSchema}
>

  <!-- Breadcrumb Navigation -->
  <nav aria-label="Breadcrumb" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
    <ol class="flex items-center space-x-2 text-sm text-muted-foreground">
      <li>
        <a href="/" class="hover:text-foreground transition-colors">Home</a>
      </li>
      <li>
        <a href="/coupon" class="hover:text-foreground transition-colors">Coupons</a>
      </li>
      <li aria-current="page" class="text-foreground font-medium">Categories</li>
    </ol>
  </nav>

  <!-- Categories Header -->
  <section class="py-16 bg-card">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center">
        <h1 class="text-4xl font-bold text-foreground mb-4">
          All Course Categories
        </h1>
        <p class="text-xl text-muted-foreground max-w-3xl mx-auto mb-8">
          Browse {validCategories.length} course categories with {coupons.length}+ verified free Udemy coupons. 
          Find the perfect course to advance your skills and career.
        </p>
        <div class="flex items-center justify-center gap-6 text-sm">
          <div class="flex items-center gap-2">
            <span class="w-2 h-2 bg-green-500 rounded-full"></span>
            <span class="text-foreground font-medium">{validCategories.length} Categories</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
            <span class="text-foreground font-medium">{coupons.length}+ Courses</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="w-2 h-2 bg-purple-500 rounded-full"></span>
            <span class="text-foreground font-medium">100% Verified</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Categories Grid -->
  <section class="py-16 bg-background">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        {categoryData.map((category: any) => (
          <a 
            href={`/category/${category.slug}`}
            class="bg-card rounded-xl border border-border overflow-hidden hover:shadow-lg transition-all group"
          >
            <div class="p-6">
              <div class="w-16 h-16 bg-gradient-to-br from-primary/20 to-secondary/20 rounded-2xl flex items-center justify-center text-3xl mb-6 group-hover:scale-110 transition-transform">
                <div set:html={category.icon} />
              </div>
              
              <h3 class="text-xl font-semibold text-foreground mb-3 group-hover:text-primary transition-colors">
                {category.name}
              </h3>
              
              <p class="text-muted-foreground mb-4 line-clamp-3">
                {category.description}
              </p>
              
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2 text-sm text-muted-foreground">
                  <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                  <span>{category.courseCount}+ Courses</span>
                </div>
                
                <div class="text-primary group-hover:text-primary/80 transition-colors">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="m9 18 6-6-6-6"/>
                    <path d="M21 6H3"/>
                  </svg>
                </div>
              </div>
            </div>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- Popular Categories Section -->
  <section class="py-16 bg-card">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-foreground mb-4">
          Most Popular Categories
        </h2>
        <p class="text-lg text-muted-foreground max-w-3xl mx-auto">
          Discover our most in-demand course categories with the highest enrollment rates
        </p>
      </div>
      
      <div class="grid md:grid-cols-3 gap-8">
        {categoryData.slice(0, 3).map((category: any) => (
          <div class="text-center">
            <div class="w-20 h-20 bg-gradient-to-br from-primary/20 to-secondary/20 rounded-3xl flex items-center justify-center text-4xl mx-auto mb-4">
              <div set:html={category.icon} />
            </div>
            <h3 class="text-xl font-semibold text-foreground mb-2">
              {category.name}
            </h3>
            <p class="text-muted-foreground mb-4">
              {category.courseCount}+ free courses available
            </p>
            <a 
              href={`/category/${category.slug}`}
              class="inline-flex items-center gap-2 text-primary hover:text-primary/80 transition-colors"
            >
              Browse Courses
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m9 18 6-6-6-6"/>
                <path d="M21 6H3"/>
              </svg>
            </a>
          </div>
        ))}
      </div>
    </div>
  </section>

</MainLayout>
