---
import Layout from '../layouts/Layout.astro';
import AffiliateLink from '../components/AffiliateLink.astro';
import { fetchPosts, formatDate, tagToLabel, paginate } from '../lib/posts';

const posts = await fetchPosts();
const pageParam = Number(Astro.url?.searchParams.get('page') ?? '1');
const { slice, currentPage, totalPages } = paginate(posts, isNaN(pageParam) ? 1 : pageParam, 6);

const featured = slice.slice(0, 3);
const latest = slice.slice(3, 6);
---

<Layout title="CoursesWyn · Best Course Reviews 2026" description="Independent reviews covering the best Udemy courses for AI, coding, and automation—ranked with real outcomes and affiliate transparency.">
  <section class="mb-16 grid gap-8 rounded-3xl border border-white/10 bg-white/5 p-10 backdrop-blur-lg lg:grid-cols-[1.2fr_0.8fr]">
    <div class="space-y-6">
      <p class="badge">Affiliate Transparency · Updated Weekly</p>
      <h1 class="text-4xl font-semibold leading-tight text-white md:text-5xl">
        Best Udemy course reviews and rankings for 2026.
      </h1>
      <p class="text-lg text-white/70">
        We audit every syllabus, instructor update, and student result before recommending Udemy reviews—covering prompt engineering, RAG, generative AI, and proven automation tracks.
      </p>
      <div class="flex flex-wrap gap-4">
        <AffiliateLink url="https://trk.udemy.com/c/6564357/3227798/39854?prodsku=prompt-engineering-masterclass" text="See Prompt Picks" />
        <a class="button-ghost" href="/blog/">Browse all reviews</a>
      </div>
      <div class="flex flex-wrap gap-3 text-sm text-white/60">
        <span class="tag-pill">Udemy Reviews</span>
        <span class="tag-pill">Best Udemy Courses</span>
        <span class="tag-pill">Prompt Engineering</span>
      </div>
    </div>
    <div class="gradient-border relative overflow-hidden rounded-[32px] border border-mint-500/20 bg-slate-900/40 p-8">
      <div class="mb-6 text-sm uppercase tracking-[0.3em] text-mint-300">This Week's Udemy Signal</div>
      <p class="text-2xl font-semibold leading-tight text-white">
        90% of best Udemy course reviews we track now mention Claude 3.5, GPT-4.1 Omni, or Gemini 2 hands-on labs.
      </p>
      <div class="mt-8 flex flex-col gap-4 text-sm text-white/70">
        <p>• Prioritize instructors that publish 2026 updates + project rubrics inside their Udemy reviews.</p>
        <p>• Bundle "best Udemy courses" lists (Prompt Eng + RAG + Automation) for a complete job-ready stack.</p>
        <p>• Watch for datasets, evaluation checklists, and office-hour replays before enrolling.</p>
      </div>
    </div>
  </section>

  <section class="mb-16">
    <div class="mb-8 flex items-center justify-between">
      <h2 class="text-2xl font-semibold text-white">Featured rundowns</h2>
      <a class="text-sm text-mint-400 hover:text-mint-300" href="/blog/">See all</a>
    </div>
    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
      {featured.map((post) => (
        <a class="card flex flex-col gap-4 border-white/10 bg-white/5" href={`/${post.slug}/`}>
          <div class="text-xs uppercase tracking-[0.3em] text-white/60">{formatDate(post.data.pubDate)}</div>
          <h3 class="text-xl font-semibold text-white">{post.data.title}</h3>
          <p class="text-sm text-white/70">{post.data.description}</p>
          <div class="flex flex-wrap gap-2">
            {post.data.tags.map((tag) => (
              <span class="tag-pill" data-tag={tag}>{tagToLabel(tag)}</span>
            ))}
          </div>
        </a>
      ))}
    </div>
  </section>

  <section class="space-y-8">
    <div class="flex items-center justify-between">
      <h2 class="text-2xl font-semibold text-white">Latest drops</h2>
      <a class="text-sm text-white/60 hover:text-white" href="/rss.xml">RSS feed</a>
    </div>
    <div class="grid gap-6 md:grid-cols-2">
      {latest.map((post) => (
        <article class="rounded-3xl border border-white/5 bg-surface/70 p-6 backdrop-blur">
          <div class="flex items-center justify-between text-sm text-white/50">
            <span>{formatDate(post.data.pubDate)}</span>
            <span>{post.data.tags.map((tag) => tagToLabel(tag)).join(' · ')}</span>
          </div>
          <h3 class="mt-4 text-xl font-semibold text-white">
            <a href={`/${post.slug}/`} class="hover:text-mint-300">{post.data.title}</a>
          </h3>
          <p class="mt-2 text-white/70">{post.data.description}</p>
          <div class="mt-6 flex gap-3 text-sm">
            <a class="text-mint-400 hover:text-mint-300" href={`/${post.slug}/`}>Read review →</a>
            <a class="text-white/60 hover:text-white" href={`/category/${post.data.tags[0]}/`}>
              {tagToLabel(post.data.tags[0])}
            </a>
          </div>
        </article>
      ))}
    </div>
  </section>

  {totalPages > 1 && (
    <section class="flex justify-center gap-4">
      {currentPage > 1 && (
        <a 
          href={currentPage > 2 ? `/?page=${currentPage - 1}` : '/'} 
          class="button-ghost"
        >
          ← Previous
        </a>
      )}
      
      <span class="text-white/60">
        Page {currentPage} of {totalPages}
      </span>
      
      {currentPage < totalPages && (
        <a 
          href={`/?page=${currentPage + 1}`} 
          class="button-ghost"
        >
          Next →
        </a>
      )}
    </section>
  )}
</Layout>
