---
import MainLayout from '../layouts/MainLayout.astro';
import HeroSection from '../components/HeroSection.astro';
import HomepageIntro from '../components/HomepageIntro.astro';
import CouponSystemExplained from '../components/CouponSystemExplained.astro';
import CoursesWynDifference from '../components/CoursesWynDifference.astro';
import CategoryGrid from '../components/CategoryGrid.astro';
import ExpiringDeals from '../components/ExpiringDeals.astro';
import PopularCourses from '../components/PopularCourses.astro';
import TrustSection from '../components/TrustSection.astro';
import InternalLinksBlock from '../components/InternalLinksBlock.astro';
import FAQSection from '../components/FAQSection.astro';
import Newsletter from '../components/Newsletter.astro';
import coupons from '../data/coupons.json';

// Get current date for dynamic content
const now = new Date();
const currentMonth = now.toLocaleDateString('en-US', { month: 'long' });
const currentYear = now.getFullYear();
const totalCoupons = coupons.length;
const lastUpdated = now.toISOString().split('T')[0]; // YYYY-MM-DD format

// Enhanced structured data for homepage
const homepageSchema = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebSite",
      name: "CoursesWyn - 100% Off Udemy Coupons",
      url: "https://courseswyn.com",
      description: `Get ${totalCoupons}+ verified 100% free Udemy coupons and discount codes in ${currentMonth} ${currentYear}. Save money on premium courses with lifetime access.`,
      dateModified: lastUpdated,
      mainEntityOfPage: {
        "@type": "WebPage",
        "@id": "https://courseswyn.com/"
      },
      potentialAction: {
        "@type": "SearchAction",
        target: "https://courseswyn.com/coupon/?q={search_term}",
        "query-input": "required name=search_term"
      }
    },
    {
      "@type": "Organization",
      name: "CoursesWyn",
      url: "https://courseswyn.com",
      description: `${totalCoupons}+ free Udemy coupons & course reviews`,
      logo: {
        "@type": "ImageObject",
        url: "https://courseswyn.com/logo.png",
        width: 512,
        height: 512
      },
      contactPoint: {
        "@type": "ContactPoint",
        contactType: "customer service",
        url: "https://courseswyn.com/contact"
      },
      sameAs: [
        "https://twitter.com/courseswyn",
        "https://facebook.com/courseswyn"
      ]
    },
    {
      "@type": "ItemList",
      name: "Latest Udemy Coupons",
      description: `Collection of ${totalCoupons}+ verified Udemy coupons and free courses`,
      numberOfItems: totalCoupons,
      dateModified: lastUpdated,
      itemListElement: coupons.slice(0, 10).map((coupon, index) => ({
        "@type": "ListItem",
        position: index + 1,
        url: `https://courseswyn.com/coupon/${coupon.slug}`,
        item: {
          "@type": "Course",
          name: coupon.title,
          description: coupon.description,
          provider: {
            "@type": "Organization",
            name: coupon.provider
          },
          offers: {
            "@type": "Offer",
            price: coupon.price === 0 ? "0" : coupon.price.toString(),
            priceCurrency: "USD",
            availability: "https://schema.org/InStock",
            validFrom: coupon.createdAt,
            url: `https://courseswyn.com/coupon/${coupon.slug}`
          }
        }
      }))
    },
    {
      "@type": "BreadcrumbList",
      itemListElement: [
        {
          "@type": "ListItem",
          position: 1,
          name: "Home",
          item: "https://courseswyn.com/"
        }
      ]
    }
  ]
};

// SEO-optimized title and description
const pageTitle = `Udemy Coupons ${currentMonth} ${currentYear} â€“ 100% Working Coupon Codes & Free Courses | CoursesWyn`;
const pageDescription = `Find verified Udemy coupons and 100% off coupon codes updated daily. Get free courses with lifetime access. Limited-time deals on Python, React, AWS, and more. Save money on premium education.`;
---

<MainLayout 
  title={pageTitle}
  description={pageDescription}
  canonical="https://courseswyn.com/"
  ogImage="https://courseswyn.com/og-homepage.jpg"
  structuredData={homepageSchema}
>

  <!-- Breadcrumb Navigation -->
  <nav aria-label="Breadcrumb" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
    <ol class="flex items-center space-x-2 text-sm text-muted-foreground">
      <li>
        <a href="/" class="hover:text-foreground transition-colors">Home</a>
      </li>
      <li aria-current="page" class="text-foreground font-medium">Udemy Coupons</li>
    </ol>
  </nav>

  <HeroSection 
    totalCoupons={totalCoupons}
    currentMonth={currentMonth}
    currentYear={currentYear}
  />

  <CategoryGrid />

  <ExpiringDeals />

  <PopularCourses />

  <HomepageIntro />

  <CouponSystemExplained />

  <CoursesWynDifference />

  <TrustSection />

  <InternalLinksBlock />

  <FAQSection />

  <Newsletter />

</MainLayout>
